<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{management_panel_layout.html}">
<head>
  <title>Create Product</title>
  <style>
    /* Remove default bullets */
    ul, #myUL {
      list-style-type: none;
    }

    /* Remove margins and padding from the parent ul */
    #myUL {
      margin: 0;
      padding: 0;
    }

    /* Style the caret/arrow */
    .caret {
      cursor: pointer;
      user-select: none; /* Prevent text selection */
    }

    /* Create the caret/arrow with a unicode, and style it */
    .caret::before {
      content: "\25B6";
      color: black;
      display: inline-block;
      margin-right: 6px;
    }

    /* Rotate the caret/arrow icon when clicked on (using JavaScript) */
    .caret-down::before {
      transform: rotate(90deg);
    }

    /* Hide the nested list */
    .nested {
      display: none;
    }

    /* Show the nested list when the user clicks on the caret/arrow (with JavaScript) */
    .active {
      display: block;
    }
  </style>
</head>
<div layout:fragment="content">

  <!--  <div id="create-part-one">-->
  <div style="margin-bottom: 2em;">
    <!-- Return to viewing products button -->
    <a class="btn btn-outline-primary" href="/management/product/">
      Return to Products
    </a>
  </div>
  <div>
    <!-- Heading -->
    <h2 style="text-align: center">Create New Product</h2>
  </div>

  <div class="container gy-3">
    <div class="card">
      <div class="card-body">
        <!-- Form to create a product_group -->
        <form id="create-product-group-form" action="/api/secured/products" method="post" class="row g-3">
          <div class="col-12 form-field">
            <label for="name" class="form-label">Product Name:</label>
            <input type="text" class="form-control" id="name" name="name" required style="border-color: #dc3545">
            <small style="color: #dc3545">Name cannot be blank.</small>
          </div>
          <div class="col-md-6 form-field">
            <label for="brand" class="form-label">Brand:</label>
            <input type="text" class="form-control" id="brand" name="brand" style="border-color: #dc3545">
            <small style="color: #dc3545">Brand cannot be blank.</small>
          </div>
          <div class="col-md-6 form-field">
            <label for="price" class="form-label">Price ($CAD):</label>
            <input type="number" step=".01" class="form-control" id="price" name="price" required style="border-color: #dc3545">
            <small style="color: #dc3545">Price cannot be blank.</small>
          </div>
          <div class="col-md-12 form-field">
            <label for="is-published" class="form-check-label">Do you want this product to be published?</label>
            <input type="checkbox" class="form-check-input" id="is-published" name="is-published">
            <div class="form-text">(A published product is one that shows up on the marketplace)</div>
          </div>
          <div class="col-md-12 form-field">
            <label for="is-big-item" class="form-check-label">Is this product a "Big Item"?</label>
            <input type="checkbox" class="form-check-input" id="is-big-item" name="is-big-item">
            <div class="form-text">(A "Big Item" is one that can only be ordered once per year)</div>
          </div>
          <div class="col-md-12 form-field">
            <label for="is-waitlistable" class="form-check-label">Is this product "waitlistable"?</label>
            <input type="checkbox" class="form-check-input" id="is-waitlistable" name="is-waitlistable">
            <div class="form-text">(A "Waitlistable Item" is one that can recieve waitlist orders when the stock is low)</div>
          </div>
          <div class="col-12 form-field">
            <label for="description">Product Description:</label>
            <textarea class="form-control" id="description" name="description" rows="3" required style="border-color: #dc3545"></textarea>
            <small style="color: #dc3545">Description cannot be blank.</small>
          </div>
          <div class="col-12">
            <label for="categories" class="form-label">Category:</label>
            <select name="categories" id="categories" class="form-select" required>

            </select>
          </div>
          <div class="col-12">
            <button class="btn btn-outline-primary" id="edit-categories-modal-button"
                   style="float: right;" data-bs-toggle="modal" data-bs-target="#edit-categories-modal">
              Edit Categories
            </button>
          </div>
          <p class="text-center" id="if-no-categories" style="display: none; color: red;">
            There are no categories in the database.
            Please make one before creating a product
            as all products MUST be assigned to a category.
          </p>
          <!--        &lt;!&ndash; Show the user a popup modal allowing them to confirm the info they are trying to submit &ndash;&gt;-->
          <!--        <div class="modal fade" id="confirm-product-group-create-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">-->
          <!--          <div class="modal-dialog">-->
          <!--            <div class="modal-content">-->
          <!--              <div class="modal-header">-->
          <!--                <h5 class="modal-title">Confirm Submit</h5>-->
          <!--                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>-->
          <!--              </div>-->
          <!--              <div class="modal-body">-->
          <!--                Are you sure you want to submit the following details?-->
          <!--                <table class="table">-->
          <!--                  <tr>-->
          <!--                    <th>Name</th>-->
          <!--                    <td id="display-new-name"></td>-->
          <!--                  </tr>-->
          <!--                  <tr>-->
          <!--                    <th>Brand</th>-->
          <!--                    <td id="display-new-brand"></td>-->
          <!--                  </tr>-->
          <!--                  <tr>-->
          <!--                    <th>Price</th>-->
          <!--                    <td id="display-new-price"></td>-->
          <!--                  </tr>-->
          <!--                  <tr>-->
          <!--                    <th>Is Published</th>-->
          <!--                    <td id="display-new-is-published"></td>-->
          <!--                  </tr>-->
          <!--                  <tr>-->
          <!--                    <th>Is Big Item</th>-->
          <!--                    <td id="display-new-is-big-item"></td>-->
          <!--                  </tr>-->
          <!--                  <tr>-->
          <!--                    <th>Is Waitlistable</th>-->
          <!--                    <td id="display-new-is-waitlisted"></td>-->
          <!--                  </tr>-->
          <!--                  <tr>-->
          <!--                    <th>Description</th>-->
          <!--                    <td id="display-new-description"></td>-->
          <!--                  </tr>-->
          <!--                  <tr>-->
          <!--                    <th>Category</th>-->
          <!--                    <td id="display-new-category"></td>-->
          <!--                  </tr>-->
          <!--                </table>-->
          <!--              </div>-->
          <!--              <div class="modal-footer">-->
          <!--                <button type="button" class="btn btn-outline-default" data-bs-dismiss="modal">Cancel</button>-->
          <!--                <input class="btn btn-outline-primary" type="submit" value="Submit">-->
          <!--              </div>-->
          <!--            </div>-->
          <!--          </div>-->
          <!--        </div>-->
        </form>
      </div>
    </div>
    <br>
    <div class="card">
      <div class="card-body" style="text-align: center;">
        <h4>Upload Media</h4>
        <form method="POST" enctype="multipart/form-data" id="file-upload-form">
          <p><label for="image-upload" style="cursor: pointer;">Click To Upload File</label></p>
          <input type="file" accept="image/jpeg, image/png" name="image" id="image-upload"
                 style="display: none;">
        </form>
        <span id="image-upload-result"></span>
        <div id="uploaded-images-container"
             style="display: none; width: 100%; height: 300px;">

        </div>
      </div>
    </div>
    <br>
    <div class="card">
      <div class="card-body" style="text-align: center;">
        <h4>Options</h4>
        <small><i>Select which options you would like your product to have</i></small>
        <div class="table-responsive" style="text-align: left;">
          <table id="attributesTable" class="table table table-striped table-hover">
            <th:block th:each="attributeGroup : ${attributeGroups}">
              <!--          th:if="${!attributeGroup?.getAttributes().isEmpty()}"-->
              <tr th:data-index="${attributeGroupStat.index}" th:data-id="${attributeGroup?.getID()}">
                <th scope="col" th:text="${attributeGroup?.getName()} ?: 'N/A'"></th>
                <th:block th:each="attribute : ${attributeGroup?.getAttributes()}">
                  <td>
                    <input type="checkbox" th:data-attrid="${attribute?.getID()}"
                           th:id="'product-' + ${attributeGroup?.getName()} + '-' + ${attribute?.getValue()}"
                           th:data-attrvalue="${attribute?.getValue()}"
                           th:name="'selection'+${attributeGroupStat.index}">
                    <label th:for="'product-' + ${attributeGroup?.getName()} + '-' + ${attribute?.getValue()}" th:text="${attribute?.getValue()}"></label>
                  </td>
                </th:block>
              </tr>
            </th:block>
          </table>
        </div>
        <a class="btn btn-outline-primary" style="float: left;" data-bs-toggle="modal" href="#create-attributes-landing-modal" role="button" disabled>Create Attribute</a>
        <button style="float: right;" class="btn btn-outline-primary" onclick="create_all_possible_products()">Continue</button>
      </div>
    </div>
  </div>
  <!--  </div>-->

  <br>
  <div class="card">
    <div class="card-body">
      <!--      <section id="create-part-two" style="display: none">-->
      <h3 style="text-align: center">Variants</h3>
      <!--    <button class="btn btn-outline-primary" onclick="go_back_to_part_one()">Go Back to Part One</button>-->
      <!--        <div style="display: table">-->
      <!--          <div style="display: table-row">-->
      <!--            <div style="display: table-cell">Product</div>-->
      <!--            <div style="display: table-cell">Image File</div>-->
      <!--            <div style="display: table-cell">Low Stock Limit</div>-->
      <!--          </div>-->
      <!--          <form id="finishProductsForm" action="/management/api/product/batch" method="post">-->

      <!--          </form>-->
      <!--        </div>-->
      <form id="finishProductsForm" action="/management/api/product/batch" method="post">
        <div class="table-responsive">
          <table id="variantsTable" class="table table table-striped table-hover">
            <thead>
            <tr>
              <th scope="col">Variant</th>
              <th scope="col">Image File</th>
              <th scope="col">Low Stock Limit</th>
            </tr>
            </thead>
            <tbody id="finishProductsFormBody">
            </tbody>
            <tfoot>
            <th scope="row">Change All Low Stock Limit</th>
            <td><input type="number" id="changeAllLowStockLimitInput" min="0" value="0"></td>
            <td><button type="button" class="btn btn-primary rounded-pill text-decoration-none" onclick="set_all_low_stock_input()">Set All</button></td>
            </tfoot>
          </table>
        </div>
      </form>
      <div class="col-md-12">
        <button class="btn btn-success" style="float: right;" onclick="submit_all()">Save</button>
        <!--      <input class="btn btn-outline-primary" id="submit-create-product-group" type="button"-->
        <!--             value="Submit" data-bs-toggle="modal" data-bs-target="#confirm-product-group-create-modal">-->
      </div>
      <!--      </section>-->
    </div>
  </div>


  <div class="modal fade" id="edit-categories-modal" tabindex="-1" role="dialog"
       aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Edit Categories</h5>
        </div>
        <div class="modal-body">
<!--          <h5 class="modal-title">Sample Title</h5>-->

<!--          <ul th:each="category : ${categories}" th:if="${category?.getParent()?.getId() == null}" id="myUL">-->
<!--            <li><span th:text="${category?.getName()}" th:id="'category-'+${category?.getId()}" class="caret"></span>-->
<!--              <ul th:if="${category?.getSubcategories() != null and !(category?.getSubcategories().isEmpty())}"-->
<!--                  class="nested">-->
<!--                <li th:each="subCategory : ${category?.getSubcategories()}" th:text="${subCategory?.getName()}"></li>-->
<!--              </ul>-->
<!--            </li>-->
<!--          </ul>-->
          <button class="btn btn-outline-primary btn-sm button-filter" id="expand-option" type="button">Expand All</button>
          <button class="btn btn-outline-primary btn-sm button-filter" id="collapse-option" type="button">Collapse All</button>
          <button class="btn btn-outline-primary btn-sm button-filter"
                  id="create-new-category-button" type="button"
                  data-bs-toggle="modal" data-bs-target="#create-new-parent-category-modal">Create New Parent Category</button>
          <br>
          <br>
          <div class="accordion" id="categoryAccordionPanels">
            <div th:each="category : ${categories}"
                 th:if="${category?.getParent()?.getId() == null}"
                 class="accordion-item">
              <h2 class="accordion-header"
                  th:id="'panelsStayOpen-heading-'+${categoryStat.index}">
                <button class="accordion-button" type="button" data-bs-toggle="collapse"
                        th:data-bs-target="'#panelsStayOpen-collapse-'+${categoryStat.index}" aria-expanded="true"
                        th:aria-controls="'panelsStayOpen-collapse-'+${categoryStat.index}" th:text="${category?.getName()}">
                </button>
              </h2>
              <div th:id="'panelsStayOpen-collapse-'+${categoryStat.index}" class="accordion-collapse collapse"
                   th:aria-labelledby="'panelsStayOpen-heading-'+${categoryStat.index}">
                <div class="accordion-body">
                  <table class="table">
                    <thead>
                      <tr>
                        <th scope="col">Subcategory</th>
                        <th scope="col">Edit</th>
                        <th scope="col">Delete</th>
                      </tr>
                    </thead>
                    <tbody th:id="'subcategory-table-'+${categoryStat.index}">
                      <tr th:each="subCategory : ${category?.getSubcategories()}">
                        <td th:text="${subCategory?.getName()}" th:id="'subcategory-text-'+${subCategory?.getId()}"></td>
                        <td style="padding: 5px;">
                            <button class="btn btn-outline-primary button-edit"
                                    type="button" style="font-size: 15px;"
                                    th:data-subcat-id="${subCategory?.getId()}"
                                    onclick="display_edit_subcategory_modal(this)">
                              <i class="far fa-edit"></i>
                            </button>
                        </td>
                        <td style="padding: 5px;">
                          <button class="btn btn-outline-primary button-edit"
                                  type="button" style="font-size: 15px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                              <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                              <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                            </svg>
                          </button>
                        </td>
                      </tr>
                      <tr th:if="${#lists.isEmpty(category?.getSubcategories())}">
                        <td>No Subcategories</td>
                      </tr>
                    </tbody>
                    <tfoot>
                      <tr>
                        <td>
                          <button type="button" class="btn btn-primary" id="add-sub-cat-button"
                                  th:data-subcat-table-id="${categoryStat.index}"
                                  th:data-parent-cat-id="${category?.getId()}"
                                  th:data-parent-cat-name="${category?.getName()}"
                                  onclick="display_create_subcategory_modal(this)">+Add Subcategory</button>
<!--                          <label th:for="'new-subcategory-'+${categoryStat.index}"-->
<!--                                 class="form-label" style="display: none;">Enter New Subcategory Name:</label>-->
<!--                          <input type="text" class="form-control"-->
<!--                                 th:data-subcat-table-id="${categoryStat.index}"-->
<!--                                 th:data-parent-cat-id="${category?.getId()}"-->
<!--                                 th:data-parent-cat-name="${category?.getName()}"-->
<!--                                 th:id="'new-subcategory-'+${categoryStat.index}"-->
<!--                                 th:name="'new-subcategory-'+${categoryStat.index}"-->
<!--                                 style="display: none;">-->
<!--                          <br>-->
<!--                          <button th:id="'save-sub-cat-button-'+${categoryStat.index}"-->
<!--                                  type="button" class="btn btn-success submit-create-category"-->
<!--                                  onclick="display_new_subcategory_details(this)" style="display: none;"-->
<!--                                  data-bs-toggle="modal" data-bs-target="#confirm-category-submit">Save</button>-->
<!--                          <button th:id="'discard-sub-cat-button-'+${categoryStat.index}"-->
<!--                                  type="button" class="btn btn-danger"-->
<!--                                  onclick="cancel_new_subcategory(this)" style="display: none">Cancel</button>-->
                        </td>
                      </tr>
                    </tfoot>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-default" data-bs-dismiss="modal">Return</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="create-new-parent-category-modal" aria-hidden="true"
       aria-labelledby="exampleModalToggleLabel" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Create New Parent Category</h5>
        </div>
        <div class="modal-body">
          <label for="new-parent-category-input" class="form-label">Enter New Name</label>
          <input type="text" class="form-control"
                 id="new-parent-category-input" name="new-subcategory" placeholder="Ex. &quot;Accessories&quot;">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-default" data-bs-dismiss="modal">Return</button>
          <button id="save-new-parent-category-button-1"
                  class="btn btn-outline-primary"
                  onclick="display_new_parent_category_details()">Save</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="confirm-parent-category-submit" tabindex="-1" role="dialog"
       aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Confirm Submit</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Are you sure you want to submit the following details?
          <table class="table">
            <tr>
              <th>Category Name</th>
              <td id="display-new-parent-category-name"></td>
            </tr>
          </table>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-default" data-bs-dismiss="modal">Return</button>
          <button id="save-new-parent-category-button-2"
                  class="btn btn-success"
                  onclick="save_new_parent_category()">Save</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="create-new-subcategory-modal" aria-hidden="true"
       aria-labelledby="exampleModalToggleLabel" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Create New Subcategory</h5>
        </div>
        <div class="modal-body">
          <label for="new-subcategory-input" class="form-label"
                 id="new-subcategory-input-label">Enter New Subcategory Name</label>
          <input type="text" class="form-control"
                 id="new-subcategory-input" name="new-subcategory" placeholder="Ex. &quot;Men's Hoodies&quot;">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-default" data-bs-dismiss="modal">Return</button>
          <button id="save-new-subcategory-button-1"
                  class="btn btn-outline-primary"
                  onclick="display_new_subcategory_details()">Save</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="confirm-new-subcategory-modal" tabindex="-1" role="dialog"
       aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Create New Subcategory</h5>
        </div>
        <div class="modal-body">
          Are you sure you want to submit the following details?
          <table class="table">
            <tr>
              <th>New Subcategory Name</th>
              <td id="display-new-subcategory-name"></td>
            </tr>
            <tr>
              <th>For Parent Category</th>
              <td id="display-for-parent-category-name"></td>
            </tr>
          </table>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-default" data-bs-dismiss="modal">Return</button>
          <button id="save-new-subcategory-button-2"
                  class="btn btn-success"
                  onclick="save_new_subcategory()">Save</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="edit-subcategory-modal" aria-hidden="true"
       aria-labelledby="exampleModalToggleLabel" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Edit Subcategory</h5>
        </div>
        <div class="modal-body">
          <table class="table">
            <tr>
              <th>Current Subcategory Name</th>
              <td id="display-current-subcategory-name"></td>
            </tr>
            <tr>
              <th>Enter New Subcategory Name</th>
              <td>
                <input type="text" class="form-control"
                       id="edit-subcategory-input" name="edit-subcategory-input" placeholder="Ex. &quot;Men's Hoodies&quot;">
              </td>
            </tr>
          </table>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-default" data-bs-dismiss="modal">Return</button>
          <button id="edit-new-subcategory-button-1"
                  class="btn btn-outline-primary"
                  onclick="display_edit_subcategory_details()">Save</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="confirm-edit-subcategory-modal" tabindex="-1" role="dialog"
       aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Edit New Subcategory</h5>
        </div>
        <div class="modal-body">
          Are you sure you want to submit the following details?
          <table class="table">
            <tr>
              <th>Currently Stored Subcategory Name</th>
              <td id="display-currently-stored-subcategory-name"></td>
            </tr>
            <tr>
              <th>New Subcategory Name</th>
              <td id="display-new-edit-subcategory-name"></td>
            </tr>
          </table>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-default" data-bs-dismiss="modal">Return</button>
          <button id="save-new-subcategory-button"
                  class="btn btn-success"
                  onclick="save_edit_subcategory()">Save</button>
        </div>
      </div>
    </div>
  </div>





  <!-- CREATE PRODUCT_GROUP SUCCESS/FAIL POPUP MODALS -->
  <div class="modal fade" id="create-product-group-success-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Complete</h5>
          <!--          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>-->
        </div>
        <div class="modal-body text-center">
          <span style="font-size: 35px;font-weight: bold;">Successfully Created</span><br>
          <i class="fa fa-check-circle-o rubberBand animated" style="font-size: 100px;color: rgb(122, 214, 94);height: 41px;"></i>
        </div>
        <div class="modal-footer" id="success-footer">
          <a id="success-redirect" class="btn btn-outline-default" href="/management/product">View Product</a>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="create-product-group-fail-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Failed to Create</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center">
          <span style="font-size: 35px;font-weight: bold;">Creation Failed</span><br>
          <i class="fa fa-close rubberBand animated" style="font-size: 100px;color: rgb(242, 15, 0);height: 41px;"></i><br>
          <p class="text-start" id="create-product-group-fail-message"></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-default" data-bs-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- CREATE CATEGORY SUCCESS/FAIL POPUP MODALS -->
  <div class="modal fade" id="create-category-form-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Create Category Form</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center">
          <form id="create-category-form" action="/management/api/category" method="post">
            <div class="col-md-6">
              <label for="category-name" class="form-label">Name:</label>
              <input type="text" id="category-name" name="category-name" class="form-control" required>
            </div>
            <div class="col-md-6">
              <label for="current-categories" class="form-label">Parent Category:</label>
              <select name="current-categories" id="current-categories" class="form-select" required>
                <option value=null selected>None</option>
              </select>
            </div>
            <div class="col-md-12">
              <input class="btn btn-outline-primary" id="submit-create-category" type="button" value="Submit" data-bs-toggle="modal" data-bs-target="#confirm-category-submit">
            </div>

            <!-- Show the user a popup modal allowing them to confirm the info they are trying to submit -->
            <div class="modal fade" id="confirm-category-submit" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title">Confirm Submit</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    Are you sure you want to submit the following details?
                    <table class="table">
                      <tr>
                        <th>Name</th>
                        <td id="display-new-category-name"></td>
                      </tr>
                      <tr>
                        <th>Parent Category:</th>
                        <td id="display-new-parent-category"></td>
                      </tr>
                    </table>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-outline-default" data-bs-dismiss="modal">Cancel</button>
                    <input class="btn btn-outline-primary" type="submit" value="Submit">
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>
        <!--          <div class="modal-footer">-->
        <!--            <a class="btn btn-outline-success" data-bs-dismiss="modal">Close</a>-->
        <!--          </div>-->
      </div>
    </div>
  </div>
  <div class="modal fade" id="create-category-success-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Complete</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center">
          <span style="font-size: 35px;font-weight: bold;">Successfully Created</span><br>
          <i class="fa fa-check-circle-o rubberBand animated" style="font-size: 100px;color: rgb(122, 214, 94);height: 41px;"></i>
        </div>
        <div class="modal-footer">
          <a class="btn btn-outline-success" data-bs-dismiss="modal">Close</a>
        </div>
      </div>
    </div>
  </div>


  <div class="modal fade" id="categories-landing-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Categories</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Hi, welcome to the Categories editing modal. <br><br>Categories operate on a parent-child relationship such as
          'Apparel' -> 'Hoodies'. <br><br>In our system, there can be no subcategories of subcategories (ie Grandchildren) so
          something such as 'Apparel' -> 'Hoodies' -> 'Men's Hoodies' would NOT be allowed since 'Men's Hoodies' would be
          a grandchild of 'Apparel'. <br><br>With all that said, please select one of the following options to continue:
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-primary" id="categories-create-new-modal-button"
                  data-bs-toggle="modal" data-bs-target="#categories-create-new-modal">Create New</button>
          <input class="btn btn-outline-primary" id="categories-edit-existing-modal-button" type="button" value="Edit Existing"
                 data-bs-toggle="modal" data-bs-target="#categories-edit-existing-modal">
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="categories-create-new-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Create New Category</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Please select one of the following options:
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-primary" id="categories-create-new-parent-modal-button" data-bs-dismiss="modal"
                  data-bs-toggle="modal" data-bs-target="#categories-create-new-parent-modal">Create New Parent Category</button>
          <input class="btn btn-outline-primary" id="categories-create-new-subcategory-modal-button" type="button"
                 data-bs-dismiss="modal"
                 value="Create New Subcategory" data-bs-toggle="modal" data-bs-target="#categories-create-new-subcategory-modal">
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="categories-create-new-parent-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Create New Category</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Please select one of the following options:
        </div>
        <div class="modal-footer">
          <!--          <input class="btn btn-outline-primary" id="categories-create-new-parent-modal-button" type="button"-->
          <!--                 value="Create New Parent Category" data-bs-toggle="modal" data-bs-target="#categories-create-new-parent-modal"-->
          <!--                 data-bs-dismiss="modal">-->
          <!--          <input class="btn btn-outline-primary" id="categories-create-new-subcategory-modal-button" type="button"-->
          <!--                 data-bs-dismiss="modal" value="Create New Subcategory" data-bs-toggle="modal" -->
          <!--                 data-bs-target="#categories-create-new-subcategory-modal">-->
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="categories-create-new-subcategory-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Create New Category</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Please select one of the following options:
        </div>
        <div class="modal-footer">
          <!--          <input class="btn btn-outline-primary" id="categories-create-new-parent-modal-button" type="button"-->
          <!--                 data-bs-dismiss="modal"-->
          <!--                 value="Create New Parent Category" data-bs-toggle="modal" data-bs-target="#categories-create-new-parent-modal">-->
          <!--          <input class="btn btn-outline-primary" id="categories-create-new-subcategory-modal-button" type="button"-->
          <!--                 value="Create New Subcategory" data-bs-toggle="modal" data-bs-target="#categories-craete-new-subcategory-modal">-->
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="create-attributes-landing-modal" tabindex="-1" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Attributes</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Hi, welcome to the Attributes editing page. <br><br>Please select one of the following options to continue:
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#attributes-create-new-modal" data-bs-dismiss="modal">Create New</button>
          <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#attributes-edit-modal" data-bs-dismiss="modal">Edit Existing</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="attributes-create-new-modal" tabindex="-1" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Create Attributes</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Hi, welcome to the Attributes creation page. <br><br>Please select one of the following options to continue:
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-primary" onclick="generate_create_attribute_form()">Create New Attribute</button>
          <button class="btn btn-outline-primary" data-bs-toggle="modal"
                  data-bs-target="#attributes-add-option-modal" data-bs-dismiss="modal">Add Options to Existing</button>
          <button class="btn btn-outline-primary" data-bs-toggle="modal"
                  data-bs-target="#attributes-add-option-modal" data-bs-dismiss="modal">Back</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="attributes-create-new-modal2" tabindex="-1" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Create Attributes</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="attributes-create-new-modal2-body">

        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-warning"  data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-outline-success" onclick="submit_attribute()">Submit</button>
          <button class="btn btn-outline-primary" data-bs-toggle="modal"
                  data-bs-target="#attributes-add-option-modal" data-bs-dismiss="modal">Back</button>
        </div>
      </div>
    </div>
  </div>

  <!--  Upon page load, an AJAX get request is done to get all of the the current categories
        in the database. If that request fails, display this popup modal-->
  <div class="modal fade" id="get-stored-category-fail-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Failed to Get Categories</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center">
          <span style="font-size: 35px;font-weight: bold;">Data Retrieval Failed</span><br>
          <i class="fa fa-close rubberBand animated" style="font-size: 100px;color: rgb(242, 15, 0);height: 41px;"></i><br>
          <p class="text-start" id="get-stored-category-fail-message"></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-default" data-bs-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="wait-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="wait-modal-title"></h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="d-flex justify-content-center">
            <div class="spinner-border text-success" style="height: 5em; width: 5em;" role="status">
              <span class="sr-only">Loading...</span>
            </div>
          </div>
          <br>
          <div class="justify-content-center">
            Currently saving data...do NOT halt the process by closing or refreshing the tab to ensure full completion!
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="success-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="success-modal-title">Complete</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center">
          <span style="font-size: 35px;font-weight: bold;" id="success-modal-message">Successfully Created</span><br>
          <i class="fa fa-check-circle-o rubberBand animated" style="font-size: 100px;color: rgb(122, 214, 94);height: 41px;"></i>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-default" data-bs-dismiss="modal">Return</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="failed-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="failed-modal-title">Failed</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center">
          <span style="font-size: 35px;font-weight: bold;" id="failed-modal-message-header"></span><br>
          <i class="fa fa-close rubberBand animated" style="font-size: 100px;color: rgb(242, 15, 0);height: 41px;"></i><br>
          <p class="text-start" id="failed-modal-message"></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-default" data-bs-dismiss="modal">Return</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    /**
     * Whenever a dropdown option in any select tag is picked,
     * this function marks that option with the attribute "selected".
     * Additionally, any other options have their "selected" attribute removed.
     */
    $(document).on("change","select",function(){
      $("option[value=" + this.value + "]", this)
              .attr("selected", true).siblings()
              .removeAttr("selected")
    });

    /**
     * Upon page load, get all the current categories from the database
     * and load them into the empty <select> tag in the html.
     */
    $(document).ready(function(){
      fill_current_categories();
    });

    var testing;
    /**
     * Gets all current attributes from the database. If:
     * (1) - There are no categories, dont let them submit at all
     * (2) - Load all the existing categories into the <select> tags
     */
    function fill_current_categories(){
      $.ajax({
        type: "GET",
        url: '/api/secured/categories/',
        beforeSend: function(xhr) {
          // xhr.setRequestHeader(
          //         $('meta[name=_csrf_header]').attr('content'),
          //         $('meta[name=_csrf]').attr('content')
          // )
        },
        success: function(data)
        {
          if(jQuery.isEmptyObject(data['categories'])){
            $("#submit-create-product-group").prop("disabled", true);
            $('#if-no-categories').css("display", "");
          }
          else{
            $('#if-no-categories').css("display", "none");
            $('#categories').empty();
            for(let i = 0; i < data['categories'].length; i++){
              if(data['categories'][i]['parent'] === null){
                if(i === 0){
                  $('#categories').append($('<option>', {
                    selected: true,
                    value: data['categories'][i]['id'],
                    text : data['categories'][i]['name']
                  }));
                }
                else{
                  $('#categories').append($('<option>', {
                    value: data['categories'][i]['id'],
                    text : data['categories'][i]['name']
                  }));
                }
                $('#categories option:last').css('background-color', '#f5f5f5');
                let subcategoriesList = data['categories'][i]['subcategories'];
                for(let i = 0; i < subcategoriesList.length; i++){
                  $('#categories').append($('<option>', {
                    value: subcategoriesList[i]['id'],
                    text : " - " + subcategoriesList[i]['name']
                  }));
                }
              }
            }
          }
        },
        error: function(xhr) {
          $('#get-stored-category-fail-message').text("Error Message:\'"+ xhr.responseJSON.message +"\'")
          $('#get-stored-category-fail-modal').modal('show');
        }
      });
    }


    /**
     * Note: The function may show as unused, however it IS being used.
     *       It shows as unused since the function call is inside the following
     *       Thymeleaf attribute which is from product_group_create.html:
     *       - th:attr="onclick=|fill_categories()|"
     */
    // function fill_categories(){
    //   fill_current_categories();
    //   $('#categories-landing-modal').modal('show');
    // }

    // function display_new_product_group_details(){
    //     $('#display-new-name').text($('#name').val());
    //     $('#display-new-brand').text($('#brand').val());
    //     $('#display-new-price').text("$" + $('#price').val());
    //     if ($('#is-published').is(":checked")){
    //         $('#display-new-is-published').text("Yes");
    //     }
    //     else{
    //         $('#display-new-is-published').text("No");
    //     }
    //     if ($('#is-big-item').is(":checked")){
    //         $('#display-new-is-big-item').text("Yes");
    //     }
    //     else{
    //         $('#display-new-is-big-item').text("No");
    //     }
    //     if ($('#is-waitlistable').is(":checked")){
    //         $('#display-new-is-waitlisted').text("Yes");
    //     }
    //     else{
    //         $('#display-new-is-waitlisted').text("No");
    //     }
    //     $('#display-new-description').text($('#description').val());
    //     $('#display-new-category').text($('#categories option:selected').text());
    // }

    //$('#submit-create-product-group').click(display_new_product_group_details);

    function display_new_parent_category_details(){
      $('#display-new-parent-category-name').text($('#new-parent-category-input').val());
      $('#confirm-parent-category-submit').modal('show');
    }

    function display_create_subcategory_modal(element){
      $('#new-subcategory-input-label').text("Enter New Subcategory Name for Parent Category \""+$(element).data('parent-cat-name')+"\"");

      $('#new-subcategory-input').removeData('subcat-table-id');
      $('#new-subcategory-input').removeData('parent-cat-id');
      $('#new-subcategory-input').removeData('parent-cat-name');

      $('#new-subcategory-input').attr('data-subcat-table-id', $(element).data("subcat-table-id"));
      $('#new-subcategory-input').attr('data-parent-cat-id', $(element).data("parent-cat-id"));
      $('#new-subcategory-input').attr('data-parent-cat-name', $(element).data("parent-cat-name"));

      $('#create-new-subcategory-modal').modal('show');
    }

    function display_new_subcategory_details(element){
      $('#display-new-subcategory-name').text($('#new-subcategory-input').val());
      $('#display-for-parent-category-name').text($('#new-subcategory-input').data("parent-cat-name"));

      // $('#save-new-subcategory-button').attr('data-subcat-table-id', $(element).siblings("input").data("subcat-table-id"));
      // $('#save-new-subcategory-button').attr('data-subcat-name', $(element).siblings("input").val());
      // $('#save-new-subcategory-button').attr('data-parent-cat-id', $(element).siblings("input").data("parent-cat-id"));
      $('#confirm-new-subcategory-modal').modal('show');
    }

    function display_edit_subcategory_modal(element){
      $.ajax({
        type: "GET",
        url: '/api/secured/categories/'.concat($(element).data("subcat-id")),
        success: function(data)
        {
          $('#display-current-subcategory-name').text(data['name']);

          $('#edit-subcategory-input').removeData('subcat-id');
          $('#edit-subcategory-input').attr('data-subcat-id', $(element).data("subcat-id"));

          $('#edit-subcategory-modal').modal('show');
        },
        error: function(xhr) {
          $('#failed-modal-message-header').text("Data Retrieval Failed");
          var responseMessagesString = '';
          let responseMessages = xhr.responseJSON['messages'];
          for(let i = 0; i < responseMessages.length; i++){
            responseMessagesString += ((i+1) + ". " + responseMessages[i]['message'] + "\n");
          }
          $('#failed-modal-message').text("Error Message: \n" + responseMessagesString);
          $('#failed-modal').modal('show');
        }
      });
    }

    function display_edit_subcategory_details(){
      $.ajax({
        type: "GET",
        url: '/api/secured/categories/'.concat($('#edit-subcategory-input').data("subcat-id")),
        success: function(data)
        {
          $('#display-currently-stored-subcategory-name').text(data['name'])
          $('#display-new-edit-subcategory-name').text($('#edit-subcategory-input').val());

          $('#confirm-edit-subcategory-modal').modal('show');
        },
        error: function(xhr) {
          $('#failed-modal-message-header').text("Data Retrieval Failed");
          var responseMessagesString = '';
          let responseMessages = xhr.responseJSON['messages'];
          for(let i = 0; i < responseMessages.length; i++){
            responseMessagesString += ((i+1) + ". " + responseMessages[i]['message'] + "\n");
          }
          $('#failed-modal-message').text("Error Message: \n" + responseMessagesString);
          $('#failed-modal').modal('show');
        }
      });
    }

    function save_edit_subcategory(){
      const data = {
        'name': $('#edit-subcategory-input').val()
      }

      $.ajax({
        type: "PATCH",
        url: '/api/secured/categories'.concat($('#edit-subcategory-input').data("subcat-id")),
        contentType: "application/json",
        data: JSON.stringify(data), // serializes the form's elements.
        beforeSend: function(xhr) {
          // xhr.setRequestHeader(
          //         $('meta[name=_csrf_header]').attr('content'),
          //         $('meta[name=_csrf]').attr('content')
          // )
          $('#edit-subcategory-modal').modal('hide');
          $('#confirm-edit-subcategory-modal').modal('hide');

          $('#wait-modal-title').text("Saving Subcategory...");
          $('#wait-modal').modal('show');
        },
        success: function(data)
        {
          console.log(data);
          $("#wait-modal").on('shown.bs.modal', function () {
            $('#wait-modal').modal('hide');
          });

          let oldName = $('#subcategory-text-'+data['id']).text();
          $('#subcategory-text-'+data['id']).text(data['name']);


          $('#success-modal-message').text("Successfully edited Subcategory - \"" + oldName + "\" to - \"" + data['name'] + "\"");
          $('#success-modal').modal('show');


          fill_current_categories();
        },
        error: function(xhr) {
          $("#wait-modal").on('shown.bs.modal', function () {
            $('#wait-modal').modal('hide');
          });

          $('#failed-modal-message-header').text("Edit Failed");
          var responseMessagesString = '';
          let responseMessages = xhr.responseJSON['messages'];
          for(let i = 0; i < responseMessages.length; i++){
            responseMessagesString += ((i+1) + ". " + responseMessages[i]['message'] + "\n");
          }
          $('#failed-modal-message').text("Error Message: \n" + responseMessagesString);
          $('#failed-modal').modal('show');
        }
      });

    }

    // var toggler = document.getElementsByClassName("caret");
    //
    // for (let i = 0; i < toggler.length; i++) {
    //   toggler[i].addEventListener("click", function() {
    //     this.parentElement.querySelector(".nested").classList.toggle("active");
    //     this.classList.toggle("caret-down");
    //   });
    // }

    // function enable_edit_mode(element)
    // {
    //   $(element).siblings().show();
    //   $(element).hide();
    // }

    var numNewSubcategoriesMadeInSession = 0;

    function save_new_subcategory()
    {
      const data = {
        'name': $('#new-subcategory-input').val(),
        'parentId': $('#new-subcategory-input').data('parent-cat-id')
      }

      console.log("POST Subcategory Data:");
      console.log(data);

      $.ajax({
        type: "POST",
        url: '/api/secured/categories',
        contentType: "application/json",
        data: JSON.stringify(data), // serializes the form's elements.
        beforeSend: function(xhr) {
          // xhr.setRequestHeader(
          //         $('meta[name=_csrf_header]').attr('content'),
          //         $('meta[name=_csrf]').attr('content')
          // )
          $('#create-new-subcategory-modal').modal('hide');
          $('#confirm-new-subcategory-modal').modal('hide');

          $('#wait-modal-title').text("Saving Subcategory...");
          $('#wait-modal').modal('show');
        },
        success: function(data)
        {
          console.log(data);
          $("#wait-modal").on('shown.bs.modal', function () {
            $('#wait-modal').modal('hide');
          });

          numNewSubcategoriesMadeInSession++;

          let subcategoryRow = `
                 <tr>
                    <td>${data.name}</td>
                        <td style="padding: 5px;">
                            <button class="btn btn-outline-primary button-edit"
                                    type="button" style="font-size: 15px;">
                              <i class="far fa-edit"></i>
                            </button>
                        </td>
                        <td style="padding: 5px;">
                          <button class="btn btn-outline-primary button-edit"
                                  type="button" style="font-size: 15px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                              <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                              <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                            </svg>
                          </button>
                        </td>
                      </tr>
          `;

          let subcatTableId = $('#new-subcategory-input').data("subcat-table-id");
          $("#subcategory-table-"+subcatTableId).append(subcategoryRow);

          $('#success-modal-message').text("Successfully created new Subcategory - \"" + data['name'] + "\" for Parent Category - \"" + data['parent']['name'] + "\"");
          $('#success-modal').modal('show');


          fill_current_categories();
        },
        error: function(xhr) {
          $("#wait-modal").on('shown.bs.modal', function () {
            $('#wait-modal').modal('hide');
          });

          $('#failed-modal-message-header').text("Creation Failed");
          var responseMessagesString = '';
          let responseMessages = xhr.responseJSON['messages'];
          for(let i = 0; i < responseMessages.length; i++){
            responseMessagesString += ((i+1) + ". " + responseMessages[i]['message'] + "\n");
          }
          $('#failed-modal-message').text("Error Message: \n" + responseMessagesString);
          $('#failed-modal').modal('show');
        }
      });
    }

    var numNewParentCategoriesMadeInSession = 0;

    function save_new_parent_category(){
      const data = {
        'name': $('#new-parent-category-input').val(),
        'parentId': null
      }

      $.ajax({
        type: "POST",
        url: '/api/secured/categories',
        contentType: "application/json",
        data: JSON.stringify(data), // serializes the form's elements.
        beforeSend: function(xhr) {
          // xhr.setRequestHeader(
          //         $('meta[name=_csrf_header]').attr('content'),
          //         $('meta[name=_csrf]').attr('content')
          // )
          $('#create-new-parent-category-modal').modal('hide');
          $('#confirm-parent-category-submit').modal('hide');

          $('#wait-modal-title').text("Saving Parent Category...");
          $('#wait-modal').modal('show');
        },
        success: function(data)
        {
          $("#wait-modal").on('shown.bs.modal', function () {
            $('#wait-modal').modal('hide');
          });

          numNewParentCategoriesMadeInSession++;

          let newAccordionItem = `
                 <div class="accordion-item">
                    <h2 class="accordion-header" id="panelsStayOpen-heading-dynamic-made-${numNewParentCategoriesMadeInSession}">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse"
                            data-bs-target="#panelsStayOpen-collapse-dynamic-made-${numNewParentCategoriesMadeInSession}"
                            aria-expanded="true" aria-controls="panelsStayOpen-collapse-dynamic-made-${numNewParentCategoriesMadeInSession}"
                            >${data.name}
                        </button>
                    </h2>
                    <div id="panelsStayOpen-collapse-dynamic-made-${numNewParentCategoriesMadeInSession}"
                         class="accordion-collapse collapse"
                         aria-labelledby="panelsStayOpen-heading-dynamic-made-${numNewParentCategoriesMadeInSession}">
                        <div class="accordion-body">
                            <table>
                                <tr>
                                    <td>&#8226; No Subcategories</td>
                                </tr>
                                <tr>
                                    <td>
                                        <button
                                            type="button" class="btn btn-primary" id="add-sub-cat-button"
                                            onclick="enable_edit_mode(this)">+Add Subcategory</button>
                                        <label for="new-subcategory-dynamic-made-${numNewParentCategoriesMadeInSession}""
                                            class="form-label" style="display: none;">Enter New Name</label>
                                        <input type="text" class="form-control"
                                            data-parent-cat-id="${data.id}"
                                            id="new-subcategory-dynamic-made-${numNewParentCategoriesMadeInSession}"
                                            name="new-subcategory-dynamic-made-${numNewParentCategoriesMadeInSession}"
                                            style="display: none;">
                                        <br>
                                        <button id="save-sub-cat-button-dynamic-made-${numNewParentCategoriesMadeInSession}"
                                            type="button" class="btn btn-success submit-create-category"
                                            onclick="save_new_subcategory(this)" style="display: none;"
                                            data-bs-toggle="modal" data-bs-target="#confirm-category-submit">Save
                                        </button>
                                        <button id="discard-sub-cat-button-dynamic-made-${numNewParentCategoriesMadeInSession}"
                                            type="button" class="btn btn-danger"
                                            onclick="cancel_new_subcategory(this)" style="display: none">Cancel
                                         </button>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                 </div>
          `;

          $('#categoryAccordionPanels').append(newAccordionItem);

          $('#success-modal-message').text("Successfully created new Parent Category - \"" + data['name'] + "\"");
          $('#success-modal').modal('show');


          fill_current_categories();


        },
        error: function(xhr) {
          $("#wait-modal").on('shown.bs.modal', function () {
            $('#wait-modal').modal('hide');
          });

          $('#failed-modal-message-header').text("Creation Failed");
          var responseMessagesString = '';
          let responseMessages = xhr.responseJSON['messages'];
          for(let i = 0; i < responseMessages.length; i++){
            responseMessagesString += ((i+1) + ". " + responseMessages[i]['message'] + "\n");
          }
          $('#failed-modal-message').text("Error Message: \n" + responseMessagesString);
          $('#failed-modal').modal('show');
        }
      });
    }

    // function cancel_new_subcategory(element) {
    //   $(element).hide();
    //   $(element).siblings().hide();
    //   $(element).siblings('#add-sub-cat-button').show();
    // }

    /*
    Clicking on the expand button, expands all groups
    */
    $('#expand-option').on('click', function() {
      $('.accordion-button').removeClass('collpased');
      $('.accordion-collapse').collapse('show');
    });

    /*
    Clicking on the collapse button, collapses all groups
    */
    $('#collapse-option').on('click', function() {
      $('.accordion-button').addClass('collpased');
      $('.accordion-collapse').collapse('hide');
    });

    $('#edit-categories-modal-button').on('click', function() {
      $('.accordion-button').removeClass('collpased');
      $('.accordion-collapse').collapse('show');
    });

    // function display_new_category_details(){
    //   $('#display-new-category-name').text($('#category-name').val());
    //   $('#display-new-parent-category').text($('#current-categories option:selected').text());
    // }
    // $('#submit-create-category').click(display_new_category_details);

    // $('#create-category-form').submit(
    //         function (e) {
    //           e.preventDefault();
    //
    //           const form = $(this);
    //           const url = form.attr('action');
    //           const data = {
    //             'name': $('#category-name').val(),
    //             'parentID': $('#current-categories option:selected').val()
    //           }
    //
    //           $.ajax({
    //             type: "POST",
    //             url: url,
    //             contentType: "application/json",
    //             data: JSON.stringify(data), // serializes the form's elements.
    //             beforeSend: function(xhr) {
    //               xhr.setRequestHeader(
    //                       $('meta[name=_csrf_header]').attr('content'),
    //                       $('meta[name=_csrf]').attr('content')
    //               )
    //             },
    //             success: function(data)
    //             {
    //               fill_current_categories();
    //               $('#create-category-form-modal').modal('hide');
    //               $('#confirm-category-submit').modal('hide');
    //               $('#create-category-success-modal').modal('show');
    //             },
    //             error: function(xhr) {
    //               $('#confirm-category-submit').modal('hide');
    //               $('#create-product-group-fail-message').text("Error Message:\'"+ xhr.responseJSON.message +"\'")
    //               $('#create-product-group-fail-modal').modal('show');
    //             }
    //           });
    //         }
    // );

    //End Categories
    //-----------------------------------------------------------------------------------------------------------------------
    //Start Products
    function set_all_low_stock_input(){
      $('.lowStockLimitInput').each(function (){
        $(this).val($('#changeAllLowStockLimitInput').val());
      });
    }

    function delete_variant(rowNumber){
      if(deleteTracker.includes(rowNumber)){
        const index = deleteTracker.indexOf(rowNumber);
        if (index > -1){
          deleteTracker.splice(index, 1);
        }
        $("#deleteVariant"+(rowNumber)).html("Disable");
        $("#product-create"+rowNumber).css("background-color", "transparent");
      }
      else{
        deleteTracker.push(rowNumber);
        $("#deleteVariant"+(rowNumber)).html("Restore");
        $("#product-create"+rowNumber).css("background-color", "#f78686");
      }
      console.log(deleteTracker);
    }

    var deleteTracker;
    function finish_products_table(valueCombinations, idCombinations){
      $('#finishProductsFormBody').html("");
      for(let i = 0; i < valueCombinations.length; i++){
        $('#finishProductsFormBody').append("<tr id='product-create"+(i+1)+"' data-attrids='"+idCombinations[i]+"'>" +
                "            <td>"+valueCombinations[i].toString().replaceAll(" ", "/")+"</td>\n" +
                "            <td><select id='product-image-select"+(i+1)+"' class='product-image-select'></select></td>\n" +
                "            <td><input id='product-low-stock-limit-input"+(i+1)+"' class=\"lowStockLimitInput\" type=\"number\" min=\"0\" value=\"0\"></td>" +
                "            <td><button type=\"button\" class=\"btn btn-danger rounded-pill text-decoration-none\" id='deleteVariant"+(i+1)+"' onclick='delete_variant("+(i+1)+")'>Disable</button></td>" +
                "           </tr>");
      }
      $('#finishProductsForm').data("count", valueCombinations.length);
      $('.product-image-select').each(function (i, obj) {
        for(let i = 0; i < imageUrls.length; i++){
          $(this).append($('<option>', {
            value: imageUrls[i],
            text : imageUrls[i]
          }));
        }
      });
      $('#create-part-two').css("display", "");
      deleteTracker = [];
      //$('#create-part-one').css("display", "none");
    }

    var allAttributeValues;
    var allAttributeIDS;
    var valueCombinations;
    var idCombinations;
    function create_all_possible_products(){
      //$('#create-part-two').css("display", "none");
      let totalNumAttributesOnPage = parseInt($('#attributesTable tr:last').data("index"))+1;
      //let allAttributes = new Array(totalNumAttributesOnPage);
      //console.log(totalNumAttributesOnPage);
      allAttributeValues = new Array(totalNumAttributesOnPage);
      allAttributeIDS = new Array(totalNumAttributesOnPage);
      for(let i = 0; i < allAttributeValues.length; i++){
        allAttributeValues[i] = [];
        allAttributeIDS[i] = [];
      }
      for(let i = 0; i < allAttributeValues.length; i++){
        let selectionString = 'selection'+i;
        $("input[name="+selectionString+"]:checked").each(function(index, input){
          allAttributeValues[i].push(input.dataset.attrvalue);
          allAttributeIDS[i].push(input.dataset.attrid);
        });
      }
      let allAttributeValuesFiltered = allAttributeValues.filter(function(el){
        return el.length > 0;
      });
      let allAttributeIDSFiltered = allAttributeIDS.filter(function(el){
        return el.length > 0;
      });
      allAttributeValues = allAttributeValuesFiltered;
      allAttributeIDS = allAttributeIDSFiltered;

      valueCombinations = generate_all_attribute_combinations(allAttributeValues);
      idCombinations = generate_all_attribute_combinations(allAttributeIDS);

      finish_products_table(valueCombinations, idCombinations);
    }

    // function go_back_to_part_one(){
    //     $('#create-part-two').css("display", "none");
    //     $('#create-part-one').css("display", "");
    // }

    function generate_all_attribute_combinations(allAttributeArrays){

      // First, handle some degenerate cases...
      if(!allAttributeArrays){
        // Or maybe we should toss an exception...?
        return [];
      }

      if(!Array.isArray(allAttributeArrays)){
        // Or maybe we should toss an exception...?
        return [];
      }

      if(allAttributeArrays.length == 0){
        return [];
      }

      for(let i=0; i < allAttributeArrays.length; i++){
        if(!Array.isArray(allAttributeArrays[i]) || allAttributeArrays[i].length == 0){
          // If any of the arrays in allAttributeArrays are not arrays or zero-length, return an empty array...
          return [];
        }
      }
      // Done with degenerate cases...

      // Start "odometer" with a 0 for each array in array_of_arrays.
      let odometer = new Array(allAttributeArrays.length);
      odometer.fill(0);

      let output = [];

      let newCombination = formCombination(odometer, allAttributeArrays);

      output.push(newCombination);

      while(odometer_increment(odometer, allAttributeArrays)){
        newCombination = formCombination(odometer, allAttributeArrays);
        output.push(newCombination);
      }

      return output;
    }/* combineArrays() */


    // Translate "odometer" to combinations from allAttributeArrays
    function formCombination(odometer, allAttributeArrays){
      //In Imperative Programmingese (i.e., English):
      let s_output = "";
      for(let i=0; i < odometer.length; i++){
        s_output += " " + allAttributeArrays[i][odometer[i]];
      }
      let trim_output = s_output.trim();
      //console.log(trim_output);
      return trim_output;

      // // In Functional Programmingese (Henny Youngman one-liner):
      // return odometer.reduce(
      //     function(accumulator, odometer_value, odometer_index){
      //         return "" + accumulator + array_of_arrays[odometer_index][odometer_value];
      //     },
      //     ""
      // );
    }/* formCombination() */

    function odometer_increment(odometer, allAttributeArrays){

      // Basically, work you way from the rightmost digit of the "odometer"...
      // if you're able to increment without cycling that digit back to zero,
      // you're all done, otherwise, cycle that digit to zero and go one digit to the
      // left, and begin again until you're able to increment a digit
      // without cycling it...simple, huh...?

      for(let i_odometer_digit=odometer.length-1; i_odometer_digit>=0; i_odometer_digit--){

        let maxee = allAttributeArrays[i_odometer_digit].length - 1;

        if(odometer[i_odometer_digit] + 1 <= maxee){
          // increment, and you're done...
          odometer[i_odometer_digit]++;
          return true;
        }
        else{
          if(i_odometer_digit - 1 < 0){
            // No more digits left to increment, end of the line...
            return false;
          }
          else{
            // Can't increment this digit, cycle it to zero and continue
            // the loop to go over to the next digit...
            odometer[i_odometer_digit]=0;
            continue;
          }
        }
      }/* for( let odometer_digit = odometer.length-1; odometer_digit >=0; odometer_digit-- ) */

    }/* odometer_increment() */


    // $('#create-product-group-form').submit(
    //     function (e) {
    //         e.preventDefault();
    //
    //         const form = $(this);
    //         const url = form.attr('action');
    //         const data = {
    //             'name': $('#name').val(),
    //             'brand': $('#brand').val(),
    //             'price': parseFloat($("#price").val()).toFixed(2),
    //             'isPublished': $('#is-published').is(':checked'),
    //             'isBigItem': $('#is-big-item').is(':checked'),
    //             'isWaitlistable': $('#is-waitlistable').is(':checked'),
    //             'description': $('#description').val(),
    //             'categoryID': $('#categories option:selected').val()
    //         }
    //
    //         $.ajax({
    //             type: "POST",
    //             url: url,
    //             contentType: "application/json",
    //             data: JSON.stringify(data), // serializes the form's elements.
    //             beforeSend: function(xhr) {
    //                 xhr.setRequestHeader(
    //                     $('meta[name=_csrf_header]').attr('content'),
    //                     $('meta[name=_csrf]').attr('content')
    //                 )
    //             },
    //             success: function(data)
    //             {
    //                 $('#confirm-product-group-create-modal').modal('hide');
    //                 $('#create-product-group-success-modal').modal('show');
    //                 submit_product_forms(data['ID']);
    //             },
    //             error: function(xhr) {
    //                 $('#confirm-product-group-create-modal').modal('hide');
    //                 $('#create-product-group-fail-message').text("Error Message:\'"+ xhr.responseJSON.message +"\'")
    //                 $('#create-product-group-fail-modal').modal('show');
    //             }
    //         });
    //     }
    // );

    const showError = (input, message) => {
      const formField = input.parent();

      formField.find('input').css('border-color', '#dc3545');
      formField.find('textarea').css('border-color', '#dc3545');

      const error = formField.find('small');
      error.text(message);
    };

    const showSuccess = (input) => {
      const formField = input.parent();

      formField.find('input').css('border-color', '#28a745');
      formField.find('textarea').css('border-color', '#28a745');

      const error = formField.find('small');
      error.text('');
    };

    const isRequired = (value) => {return value !== ''};

    const checkName = () => {
      let valid = false;
      const name = $('#name');
      if(!isRequired(name.val().trim())){
        showError(name, 'Name cannot be blank.')
      }
      else {
        showSuccess(name);
        valid = true;
      }
      return valid;
    };

    const checkBrand = () => {
      let valid = false;
      const brand = $('#brand');
      if(!isRequired(brand.val().trim())){
        showError(brand, 'Brand cannot be blank.')
      }
      else {
        showSuccess(brand);
        valid = true;
      }
      return valid;
    };

    const countDecimals = (value) => {
      if(Math.floor(value) != value){
        return value.toString().split(".")[1].length || 0;
      }
      return 0;
    };

    const checkPrice = () => {
      let valid = false;
      const price = $("#price");
      if(countDecimals(price.val()) > 2){
        showError(price, 'A price may not have more than 2 decimal places.');
      }
      else if(price.val().length === 0){
        showError(price, 'Price cannot be blank.');
      }
      else {
        showSuccess(price);
        valid = true;
      }
      return valid;
    };

    const checkDescription = () => {
      let valid = false;
      const description = $('#description');
      if(!isRequired(description.val().trim())){
        showError(description, 'Description cannot be blank.')
      }
      else {
        showSuccess(description);
        valid = true;
      }
      return valid;
    };

    $('#create-product-group-form').on('input', function(e){
      switch(e.target.id) {
        case 'name':
          checkName();
          break;
        case 'brand':
          checkBrand();
          break;
        case 'price':
          checkPrice();
          break;
        case 'description':
          checkDescription();
          break;
      }
    });



    function submit_all(){

      let isFormValid = checkName() && checkPrice() && checkBrand() && checkDescription();
      if(!isFormValid){
        $('html, body').animate({ scrollTop: 0 }, 'fast');
        return;
      }
      const url = '/management/api/product';
      const data = {
        'name': $('#name').val(),
        'brand': $('#brand').val(),
        'price': parseFloat($("#price").val()).toFixed(2),
        'isPublished': $('#is-published').is(':checked'),
        'isBigItem': $('#is-big-item').is(':checked'),
        'isWaitlistable': $('#is-waitlistable').is(':checked'),
        'description': $('#description').val(),
        'categoryID': $('#categories option:selected').val()
      }

      $.ajax({
        type: "POST",
        url: url,
        contentType: "application/json",
        data: JSON.stringify(data), // serializes the form's elements.
        beforeSend: function(xhr) {
          xhr.setRequestHeader(
                  $('meta[name=_csrf_header]').attr('content'),
                  $('meta[name=_csrf]').attr('content')
          );
          $('#wait-modal').modal('show');
        },
        success: function(data)
        {
          //$('#confirm-product-group-create-modal').modal('hide');
          //$('#create-product-group-success-modal').modal('show');
          submit_product_forms(data['ID']);
        },
        error: function(xhr) {
          console.log("Modal should hide...");
          $('#wait-modal').modal('hide');
          //$('#confirm-product-group-create-modal').modal('hide');
          $('#create-product-group-fail-message').text("Error Message:\'"+ xhr.responseJSON.message +"\'")
          $('#create-product-group-fail-modal').modal('show');
        }
      });
    }

    function submit_product_forms(pgid){
      let products = [];
      let numProducts = parseInt($('#finishProductsForm').data("count"));
      for(let j = 0; j < numProducts; j++){
        if(deleteTracker.includes(j+1)){
          continue;
        }
        let attributes = [];
        let arrayOfAttrIDs = $("#product-create"+(j+1)).data("attrids").toString().split(" ").map(i=>Number(i));
        for(let k = 0; k < arrayOfAttrIDs.length; k++){
          attributes.push({ "ID": arrayOfAttrIDs[k]});
        }
        const product = {
          'imagePath': $('#product-image-select'+(j+1)).val(),
          'PGID': pgid,
          'lowStockLimit': $("#product-low-stock-limit-input"+(j+1)).val(),
          'attributes': attributes
        }
        products.push(product);
      }
      console.log(products);
      if(products.length !== 0){
        $.ajax({
          type: "POST",
          url: '/management/api/product_variant/batch',
          contentType: "application/json",
          data: JSON.stringify(products), // serializes the form's elements.
          beforeSend: function(xhr) {
            xhr.setRequestHeader(
                    $('meta[name=_csrf_header]').attr('content'),
                    $('meta[name=_csrf]').attr('content')
            )
          },
          success: function()
          {
            $('#success-redirect').attr("href", "/management/product/update?id="+pgid)
            $('#wait-modal').modal('hide');
            $('#create-product-group-success-modal').modal('show');
          },
          error: function(xhr) {
            $('#wait-modal').modal('hide');
            // $('#confirm-submit').modal('hide');
            $('#create-product-group-fail-message').text("Error Message:\'"+ xhr.responseJSON.message +"\'")
            $('#create-product-group-fail-modal').modal('show');
          }
        });
      }
      else {
        $('#wait-modal').modal('hide');
        $('#create-product-group-success-modal').modal('show');
      }
    }

    let num_attributes = 0;
    let iterator_for_attribute_input = 0;
    let arr_attribute_html_ids = [];
    function generate_create_attribute_form(){
      num_attributes = 0;
      iterator_for_attribute_input = 0;
      arr_attribute_html_ids = [];
      $('#attributes-create-new-modal').modal('hide');
      const blankForm = `<table id="create-attribute-table" class="table table-hover">
            <tbody id="create-attribute-table-body">
              <tr>
                <td>
                  New Attribute Name (Ex. Size, Color,...)
                </td>
                <td>
                  <input type="text" id="attribute-group-name" name="attribute-group-name" class="form-control" placeholder="Ex. Size">
                </td>
              </tr>
              <tr id="first-row-replaced">
                  <td rowspan="2">No Attribute Options Entered</td>
              </tr>
            </tbody>
            <tfoot>
            <td rowspan="2"><button class="btn btn-outline-primary btn-sm space" onclick="add_input_for_attributes()">Add Attribute Option+</button></td>
            </tfoot>
          </table>`;
      $('#attributes-create-new-modal2-body').html(blankForm);
      $('#create-attributes-landing-modal').modal('hide');
      $('#attributes-create-new-modal').modal('hide');
      $('#attributes-create-new-modal2').modal('show');
    }


    function add_input_for_attributes(){
      if(num_attributes === 0){
        $('#first-row-replaced').html("<td>" +
                "<input type=\"text\" class=\"form-control\" id='attribute-value"+iterator_for_attribute_input+"' " +
                "name='attribute-value"+iterator_for_attribute_input+"'>" +
                "</td>" +
                "<td>" +
                "<button id='"+iterator_for_attribute_input+"' class=\"btn btn-outline-danger btn-sm space\" onclick='remove_attribute_input(this)'>Remove Attribute</button>" +
                "</td>");
      }
      else{
        $('#create-attribute-table-body').append("<tr><td>" +
                "<input type=\"text\" class=\"form-control\" id='attribute-value"+iterator_for_attribute_input+"' " +
                "name='attribute-value"+iterator_for_attribute_input+"'>" +
                "</td>" +
                "<td>" +
                "<button id='"+iterator_for_attribute_input+"' class=\"btn btn-outline-danger btn-sm space\" onclick='remove_attribute_input(this)'>Remove Attribute</button>" +
                "</td></tr>");
      }
      num_attributes++;
      arr_attribute_html_ids.push(iterator_for_attribute_input);
      iterator_for_attribute_input++;
    }

    function remove_attribute_input(buttonElement){
      console.log("BEGIN: " + arr_attribute_html_ids);
      let removedIdNumber = parseInt(buttonElement.id);
      buttonElement.closest('tr').remove();
      num_attributes--;
      if(num_attributes === 0){
        $('#create-attribute-table-body').append("<tr id='first-row-replaced'><td>No Attributes entered.</td></tr>");
      }
      for(let i = 0; i < arr_attribute_html_ids.length; i++) {
        if(removedIdNumber === parseInt(arr_attribute_html_ids[i])) {
          arr_attribute_html_ids.splice(i, 1);
        }
      }
      console.log("END: " + arr_attribute_html_ids);
    }

    function submit_attribute(){
      const data = {
        'name': $('#attribute-group-name').val().trim()
      }

      $.ajax({
        type: "POST",
        url: '/management/api/attribute_group',
        contentType: "application/json",
        data: JSON.stringify(data), // serializes the form's elements.
        beforeSend: function(xhr) {
          xhr.setRequestHeader(
                  $('meta[name=_csrf_header]').attr('content'),
                  $('meta[name=_csrf]').attr('content')
          );
          $('#attributes-create-new-modal2').modal('hide');
          $('#wait-modal').modal('show');
        },
        success: function(data)
        {
          submit_attributes(data['ID']);
        },
        error: function(xhr) {
          $('#confirm-create-attribute-group-modal').modal('hide');
          $('#create-attribute-group-fail-message').text("Error Message:\'"+ xhr.responseJSON.message +"\'")
          $('#create-attribute-group-fail-modal').modal('show');
        }
      });
    }

    function submit_attributes(agID){
      let attributes = [];
      for(let i = 0; i < arr_attribute_html_ids.length; i++){
        attributes.push({
          'attributeGroupID': agID,
          "value": $('#attribute-value'+arr_attribute_html_ids[i]+'').val()
        });
      }
      console.log(attributes);
      if(attributes.length !== 0){
        $.ajax({
          type: "POST",
          url: '/management/api/attribute/batch',
          contentType: "application/json",
          data: JSON.stringify(attributes), // serializes the form's elements.
          beforeSend: function(xhr) {
            xhr.setRequestHeader(
                    $('meta[name=_csrf_header]').attr('content'),
                    $('meta[name=_csrf]').attr('content')
            )
          },
          success: function()
          {
            $('#wait-modal').modal('hide');
          },
          error: function(xhr) {
            console.log("Modal Should Hide");
            $('#wait-modal').modal('hide');
            // $('#confirm-submit').modal('hide');
            $('#create-product-group-fail-message').text("Error Message:\'"+ xhr.responseJSON.message +"\'")
            $('#create-product-group-fail-modal').modal('show');
          }
        });
      }
      else {
        $('#wait-modal').modal('hide');
      }
    }

    var imageUrls = [];

    $("#image-upload").change(function(e){
      //stop submit the form, we will post it manually.
      e.preventDefault();

      // Get form
      var form = $('#file-upload-form')[0];

      // Create an FormData object
      var data = new FormData(form);

      // If you want to add an extra field for the FormData
      // data.append("CustomField", "This is some extra data, testing");

      // disabled the submit button
      $("#file-upload-form").prop("disabled", true);

      $.ajax({
        type: "POST",
        enctype: 'multipart/form-data',
        url: '/api/image',
        data: data,
        processData: false,
        contentType: false,
        cache: false,
        timeout: 600000,
        beforeSend: function(xhr) {
          xhr.setRequestHeader(
                  $('meta[name=_csrf_header]').attr('content'),
                  $('meta[name=_csrf]').attr('content')
          )
        },
        success: function (data) {

          $("#image-upload-result").text("Success");
          $("#image-upload-result").css('color', 'green');
          $("#uploaded-images-container").css('display', 'flex');
          console.log("SUCCESS : ", data);
          $("#file-upload-form").prop("disabled", false);
          const newImage = `
                    <div style="flex: 1;">
                        <img src="${data}" style="max-width: 100%; max-height: 300px;">
                    </div>
                `;
          $("#uploaded-images-container").append(newImage);
          $('.product-image-select').each(function () {
            for(let i = 0; i < imageUrls.length; i++){
              $(this).append($('<option>', {
                value: data,
                text : data
              }));
            }
          });
          imageUrls.push(data);

        },
        error: function (e) {
          var failText = "Failed to Upload: "
          $("#image-upload-result").text(failText.concat(e.responseText));
          $("#image-upload-result").css('color', 'red');
          console.log("ERROR : ", e);
          $("#file-upload-form").prop("disabled", false);

        }
      });

    });
  </script>

  <!--  <script th:src="@{/javascript/management/product/product_create.js}"></script>-->
</div>
</html>
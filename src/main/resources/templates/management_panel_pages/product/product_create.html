<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{management_panel_layout.html}">
<head>
  <title>Create Product</title>
  <style>
    /* Remove default bullets */
    ul, #myUL {
      list-style-type: none;
    }

    /* Remove margins and padding from the parent ul */
    #myUL {
      margin: 0;
      padding: 0;
    }

    /* Style the caret/arrow */
    .caret {
      cursor: pointer;
      user-select: none; /* Prevent text selection */
    }

    /* Create the caret/arrow with a unicode, and style it */
    .caret::before {
      content: "\25B6";
      color: black;
      display: inline-block;
      margin-right: 6px;
    }

    /* Rotate the caret/arrow icon when clicked on (using JavaScript) */
    .caret-down::before {
      transform: rotate(90deg);
    }

    /* Hide the nested list */
    .nested {
      display: none;
    }

    /* Show the nested list when the user clicks on the caret/arrow (with JavaScript) */
    .active {
      display: block;
    }

    .product-option{
      border-bottom: 1px solid black;
      padding: 20px;
    }

    .image-modal-display{
      transition: box-shadow .3s;
      border-radius:10px;
      border: 1px solid #ccc;
    }

    .image-modal-display:hover{
      box-shadow: 0 0 11px rgba(33,33,33,.2);
    }
  </style>
</head>
<div layout:fragment="content">

  <!--  <div id="create-part-one">-->
  <div style="margin-bottom: 2em;">
    <!-- Return to viewing products button -->
    <a class="btn btn-outline-primary" href="/management/product/" id="return-to-products-button">
      Return to Products
    </a>
  </div>
  <div>
    <!-- Heading -->
    <h2 style="text-align: center">Create New Product</h2>
  </div>
  <div id="create-product-part-1-info">
    <div class="container gy-3">
      <div class="card">
        <div class="card-body">
          <!-- Form to create a product_group -->
          <form id="create-product-info-form" class="row g-3">
            <div class="col-12 form-field">
              <label for="name" class="form-label">Product Name:</label>
              <input type="text" class="form-control" id="name" name="name" required style="border-color: #dc3545">
              <small style="color: #dc3545">Name cannot be blank.</small>
            </div>
            <div class="col-md-6 form-field">
              <label for="brand" class="form-label">Brand:</label>
              <input type="text" class="form-control" id="brand" name="brand" style="border-color: #dc3545">
              <small style="color: #dc3545">Brand cannot be blank.</small>
            </div>
            <div class="col-md-6 form-field">
              <label for="price" class="form-label">Price ($CAD):</label>
              <input type="number" step=".01" min="0" class="form-control" id="price" name="price" required style="border-color: #dc3545">
              <small style="color: #dc3545">Price cannot be blank.</small>
            </div>
            <!--          <div class="col-md-12 form-field">-->
            <!--            <label for="is-published" class="form-check-label">Do you want this product to be published?</label>-->
            <!--            <input type="checkbox" class="form-check-input" id="is-published" name="is-published">-->
            <!--            <div class="form-text">(A published product is one that shows up on the marketplace)</div>-->
            <!--          </div>-->
            <div class="col-md-12 form-field">
              <label for="is-big-item" class="form-check-label">Is this product a "Big Item"?</label>
              <input type="checkbox" class="form-check-input" id="is-big-item" name="is-big-item">
              <div class="form-text">(A "Big Item" is one that can only be ordered once per year)</div>
            </div>
            <div class="col-md-12 form-field">
              <label for="is-waitlistable" class="form-check-label">Is this product "waitlistable"?</label>
              <input type="checkbox" class="form-check-input" id="is-waitlistable" name="is-waitlistable">
              <div class="form-text">(A "Waitlistable Item" is one that can recieve waitlist orders when the stock is low)</div>
            </div>
            <div class="col-12 form-field">
              <label for="description">Product Description:</label>
              <textarea class="form-control" id="description" name="description" rows="3" required style="border-color: #dc3545"></textarea>
              <small style="color: #dc3545">Description cannot be blank.</small>
            </div>
            <div class="col-12">
              <label for="categories" class="form-label">Category:</label>
              <select name="categories" id="categories" class="form-select" required>

              </select>
            </div>
            <small class="text-center" id="if-no-categories" style="display: none; color: red;">
              There are no categories in the database.
              Please make one before creating a product
              as all products MUST be assigned to a category.
            </small>
          </form>
          <br>
          <div class="col-12">
            <button class="btn btn-outline-primary" id="edit-categories-modal-button"
                    style="float: right;" data-bs-toggle="modal" data-bs-target="#edit-categories-modal">
              Edit Categories
            </button>
          </div>
          <br>
          <br>
          <div class="col-12 text-center">
            <label for="has-options" class="form-check-label">This product has options, like size or colour</label>
            <input type="checkbox" class="form-check-input" id="has-options" name="has-options">
          </div>
          <br>
          <br>
          <div class="row d-flex justify-content-center" id="solo-low-stock-limit-container">
            <div class="col-6">
              <label for="solo-product-low-stock-limit" class="form-label" id="solo-low-stock-limit-label">Low Stock Limit:</label>
              <input type="number" id="solo-product-low-stock-limit" class="form-control" min="0" value="0">
            </div>
          </div>
          <br>
          <br>
          <div class="col-12" id="no-variant-submit-container">
            <button class="btn btn-success" id="no-variant-submit" style="float: right;"
                    onclick="display_new_product_details(0)">Save</button>
          </div>
        </div>
      </div>
      <br>
      <div class="card" id="options-container" style="display:none;">
        <div class="card-body" style="text-align: center;">
          <h4>Options</h4>
          <div id="options-select-container">
            <small><i>Select which options you would like your product to have</i></small>
            <div class="product-option" id="product-option-1">
              <h5>Option 1</h5>
              <label for="option-name-1" class="form-check-label">Option Name</label>
              <select class="form-select option-select" id="option-name-1" name="option-name-1" onchange="fillOptionValueSelects(this)">
                <option th:each="option : ${options}" th:value="${option.getId()}" th:text="${option.getName()}"
                        th:selected="${optionStat.index == 0}"></option>
              </select>
              <small id="if-duplicate-option-1" style="color: #dc3545; display: none;">Cannot have duplicated Options or Values!</small>
              <p class="text-center" id="if-no-option-values-1" style="display: none; color: red;">
                There are no Option Values in the database for this Option. Please make one
                using the "Edit Options" button.
              </p>
              <div id="option-values-container-1" class="option-values-container container">
                <div class="row justify-content-center">
                  <div class="col-lg-8 col-md-12 align-items-start">
                    <label for="product-option-value-1-1" class="form-check-label">Value Name</label>
                    <select class="product-option-values-1 product-option-value form-select" id="product-option-value-1-1">
                    </select>
                  </div>
                  <div class="col p-3">

                  </div>
                </div>
              </div>
              <br>
              <button class="btn btn-primary" id="add-option-value-1" onclick="add_option_value(1)">
                + Add Option Value
              </button>
            </div>
            <br>
            <button class="btn btn-primary" id="add-new-option-button">+ Add another option</button>
          </div>

          <button class="btn btn-outline-primary" id="edit-options-modal-button"
                  style="float: left;" data-bs-toggle="modal" data-bs-target="#edit-options-modal">
            Edit Options
          </button>
          <button style="float: right;" class="btn btn-outline-primary" id="generate-variants-button"
                  onclick="check_options_are_unique()">Generate Variants</button>
        </div>
      </div>
    </div>
    <!--  </div>-->

    <br>
    <div class="card" style="display: none;" id="variants-card">
      <div class="card-body">
        <!--      <section id="create-part-two" style="display: none">-->
        <h3 style="text-align: center">Variants</h3>
        <!--    <button class="btn btn-outline-primary" onclick="go_back_to_part_one()">Go Back to Part One</button>-->
        <!--        <div style="display: table">-->
        <!--          <div style="display: table-row">-->
        <!--            <div style="display: table-cell">Product</div>-->
        <!--            <div style="display: table-cell">Image File</div>-->
        <!--            <div style="display: table-cell">Low Stock Limit</div>-->
        <!--          </div>-->
        <!--          <form id="finishProductsForm" action="/management/api/product/batch" method="post">-->

        <!--          </form>-->
        <!--        </div>-->
        <form id="finishProductsForm" method="post">
          <div class="table-responsive">
            <table id="variantsTable" class="table table table-striped table-hover">
              <thead>
              <tr>
                <th scope="col">Variant</th>
                <!--              <th scope="col">Is In Use</th>-->
                <th scope="col">Low Stock Limit</th>
              </tr>
              </thead>
              <tbody id="finishProductsFormBody">
              </tbody>
              <tfoot>
              <th scope="row">Change All Low Stock Limit</th>
              <td><input type="number" id="changeAllLowStockLimitInput" class="form-control" min="0" value="0"></td>
              <td><button type="button" class="btn btn-primary rounded-pill text-decoration-none" onclick="set_all_low_stock_input()">Set All</button></td>
              </tfoot>
            </table>
          </div>
        </form>
        <div class="col-md-12">
          <button class="btn btn-success" style="float: right;" onclick="display_new_product_details(1)">Save All</button>
          <!--      <input class="btn btn-outline-primary" id="submit-create-product-group" type="button"-->
          <!--             value="Submit" data-bs-toggle="modal" data-bs-target="#confirm-product-group-create-modal">-->
        </div>
        <!--      </section>-->
      </div>
    </div>
  </div>
  <div id="create-product-part-2-images" style="display: none;">
    <div class="card">
      <div class="card-body" style="text-align: center;">
        <h4>Upload Media</h4>
        <form method="POST" enctype="multipart/form-data" id="file-upload-form">
          <p><label for="image-upload" style="cursor: pointer;">Click To Upload File</label></p>
          <input type="file" accept="image/jpeg, image/png" name="image" id="image-upload"
                 style="display: none;">
        </form>
        <span id="image-upload-result"></span>
        <div id="uploaded-images-container"
             style="display: none; width: 100%; height: 300px;">

        </div>
      </div>
    </div>
    <br>
    <div class="card" id="variants-card-2">
      <div class="card-body">
        <!--      <section id="create-part-two" style="display: none">-->
        <h3 style="text-align: center">Variants</h3>
        <!--    <button class="btn btn-outline-primary" onclick="go_back_to_part_one()">Go Back to Part One</button>-->
        <!--        <div style="display: table">-->
        <!--          <div style="display: table-row">-->
        <!--            <div style="display: table-cell">Product</div>-->
        <!--            <div style="display: table-cell">Image File</div>-->
        <!--            <div style="display: table-cell">Low Stock Limit</div>-->
        <!--          </div>-->
        <!--          <form id="finishProductsForm" action="/management/api/product/batch" method="post">-->

        <!--          </form>-->
        <!--        </div>-->
        <div class="table-responsive" id="finish-variants-table-2">
          <table id="variants-table-2" class="table table table-striped table-hover">
            <thead>
            <tr>
              <th scope="col">Image</th>
              <th scole="col">Chosen Image</th>
              <th scope="col">Variant</th>
            </tr>
            </thead>
            <tbody id="finish-variants-table-body-2">
            </tbody>
          </table>
        </div>
        <div class="col-md-12">
          <button class="btn btn-success" style="float: right;" onclick="update_variant_images()">Save All</button>
          <!--      <input class="btn btn-outline-primary" id="submit-create-product-group" type="button"-->
          <!--             value="Submit" data-bs-toggle="modal" data-bs-target="#confirm-product-group-create-modal">-->
        </div>
        <!--      </section>-->
      </div>
    </div>
  </div>


<!-- Start Categories -->
  <div class="modal fade" id="edit-categories-modal" tabindex="-1" role="dialog"
       aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Edit Categories</h5>
        </div>
        <div class="modal-body">
<!--          <h5 class="modal-title">Sample Title</h5>-->

<!--          <ul th:each="category : ${categories}" th:if="${category?.getParent()?.getId() == null}" id="myUL">-->
<!--            <li><span th:text="${category?.getName()}" th:id="'category-'+${category?.getId()}" class="caret"></span>-->
<!--              <ul th:if="${category?.getSubcategories() != null and !(category?.getSubcategories().isEmpty())}"-->
<!--                  class="nested">-->
<!--                <li th:each="subCategory : ${category?.getSubcategories()}" th:text="${subCategory?.getName()}"></li>-->
<!--              </ul>-->
<!--            </li>-->
<!--          </ul>-->
          <button class="btn btn-outline-primary btn-sm button-filter expand-option" type="button">Expand All</button>
          <button class="btn btn-outline-primary btn-sm button-filter collapse-option" type="button">Collapse All</button>
          <button class="btn btn-outline-primary btn-sm button-filter"
                  id="create-new-category-button" type="button"
                  data-bs-toggle="modal" data-bs-target="#create-new-parent-category-modal">Create New Parent Category</button>
          <br>
          <br>
          <div class="accordion" id="categoryAccordionPanels">
            <div th:if="${#lists.isEmpty(categories)}" data-has-none="true">
              No Categories Here
            </div>
            <div th:each="category : ${categories}"
                 th:if="${category?.getParent()?.getId() == null}"
                 class="accordion-item"
                 th:id="'category-accordion-'+${category?.getId()}">
              <h2 class="accordion-header"
                  th:id="'panelsStayOpen-heading-'+${categoryStat.index}">
                <button class="accordion-button" type="button" data-bs-toggle="collapse"
                        th:id="'parent-category-text-'+${category?.getId()}"
                        th:data-bs-target="'#panelsStayOpen-collapse-'+${categoryStat.index}" aria-expanded="true"
                        th:aria-controls="'panelsStayOpen-collapse-'+${categoryStat.index}" th:text="${category?.getName()}">
                </button>
              </h2>
              <div th:id="'panelsStayOpen-collapse-'+${categoryStat.index}" class="accordion-collapse collapse"
                   th:aria-labelledby="'panelsStayOpen-heading-'+${categoryStat.index}">
                <div class="accordion-body">
                  <button type="button" class="btn btn-warning"
                          th:id="'parent-category-edit-text-'+${category?.getId()}"
                          th:text="|Edit &quot${category?.getName()}&quot|"
                          th:data-cat-id="${category?.getId()}"
                          onclick="display_edit_parent_category_modal(this)"></button>
                  <button type="button" class="btn btn-danger"
                          th:id="'parent-category-delete-text-'+${category?.getId()}"
                          th:text="|Delete &quot${category?.getName()}&quot|"
                          th:data-id="${category?.getId()}"
                          th:data-type-of-delete="category"
                          th:data-name="${category?.getName()}"
                          onclick="display_delete_modal(this)"></button>
                  <table class="table">
                    <thead>
                      <tr>
                        <th scope="col">Subcategory</th>
                        <th scope="col">Edit</th>
                        <th scope="col">Delete</th>
                      </tr>
                    </thead>
                    <tbody th:id="'subcategory-table-'+${categoryStat.index}">
                      <tr th:if="${#lists.isEmpty(category?.getSubcategories())}" data-has-none="true">
                        <td>No Subcategories</td>
                      </tr>
                      <tr th:each="subCategory : ${category?.getSubcategories()}"
                          th:id="'subcategory-row-'+${subCategory?.getId()}">
                        <td th:text="${subCategory?.getName()}" th:id="'subcategory-text-'+${subCategory?.getId()}"></td>
                        <td style="padding: 5px;">
                            <button class="btn btn-outline-primary button-edit"
                                    type="button" style="font-size: 15px;"
                                    th:data-subcat-id="${subCategory?.getId()}"
                                    onclick="display_edit_subcategory_modal(this)">
                              <i class="far fa-edit"></i>
                            </button>
                        </td>
                        <td style="padding: 5px;">
                          <button class="btn btn-outline-primary button-edit"
                                  type="button" style="font-size: 15px;"
                                  th:data-id="${subCategory?.getId()}"
                                  th:data-type-of-delete="subcategory"
                                  th:data-name="${subCategory?.getName()}"
                                  onclick="display_delete_modal(this)">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                              <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                              <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                            </svg>
                          </button>
                        </td>
                      </tr>
                    </tbody>
                    <tfoot>
                      <tr>
                        <td>
                          <button type="button" class="btn btn-primary" id="add-sub-cat-button"
                                  th:data-subcat-table-id="${categoryStat.index}"
                                  th:data-parent-cat-id="${category?.getId()}"
                                  th:data-parent-cat-name="${category?.getName()}"
                                  onclick="display_create_subcategory_modal(this)">+Add Subcategory</button>
                        </td>
                      </tr>
                    </tfoot>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-default" data-bs-dismiss="modal">Return</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="create-new-parent-category-modal" aria-hidden="true"
       aria-labelledby="exampleModalToggleLabel" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Create New Parent Category</h5>
        </div>
        <div class="modal-body">
          <label for="new-parent-category-input" class="form-label">Enter New Name</label>
          <input type="text" class="form-control"
                 id="new-parent-category-input" name="new-subcategory" placeholder="Ex. &quot;Accessories&quot;">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-default" data-bs-dismiss="modal">Return</button>
          <button id="save-new-parent-category-button-1"
                  class="btn btn-outline-primary"
                  onclick="display_new_parent_category_details()">Save</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="confirm-parent-category-submit" tabindex="-1" role="dialog"
       aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Confirm Submit</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Are you sure you want to submit the following details?
          <table class="table">
            <tr>
              <th>Category Name</th>
              <td id="display-new-parent-category-name"></td>
            </tr>
          </table>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-default" data-bs-dismiss="modal">Return</button>
          <button id="save-new-parent-category-button-2"
                  class="btn btn-success"
                  onclick="save_new_parent_category()">Save</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="edit-parent-category-modal" aria-hidden="true"
       aria-labelledby="exampleModalToggleLabel" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Edit Category</h5>
        </div>
        <div class="modal-body">
          <table class="table">
            <tr>
              <th>Current Parent Category Name</th>
              <td id="display-current-parent-category-name"></td>
            </tr>
            <tr>
              <th>Enter New Parent Category Name</th>
              <td>
                <input type="text" class="form-control"
                       id="edit-parent-category-input" name="edit-parent-category-input"
                       placeholder="Ex. &quot;Accessories&quot;">
              </td>
            </tr>
          </table>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-default" data-bs-dismiss="modal">Return</button>
          <button id="edit-parent-category-button-1"
                  class="btn btn-outline-primary"
                  onclick="display_edit_parent_category_details()">Save</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="confirm-edit-parent-category-modal" tabindex="-1" role="dialog"
       aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Edit Parent Category</h5>
        </div>
        <div class="modal-body">
          Are you sure you want to submit the following details?
          <table class="table">
            <tr>
              <th>Currently Stored Parent Category Name</th>
              <td id="display-currently-stored-parent-category-name"></td>
            </tr>
            <tr>
              <th>New Parent Category Name</th>
              <td id="display-new-edit-parent-category-name"></td>
            </tr>
          </table>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-default" data-bs-dismiss="modal">Return</button>
          <button id="edit-parent-category-button-2"
                  class="btn btn-success"
                  onclick="save_edit_parent_category()">Save</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="create-new-subcategory-modal" aria-hidden="true"
       aria-labelledby="exampleModalToggleLabel" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Create New Subcategory</h5>
        </div>
        <div class="modal-body">
          <label for="new-subcategory-input" class="form-label"
                 id="new-subcategory-input-label">Enter New Subcategory Name</label>
          <input type="text" class="form-control"
                 id="new-subcategory-input" name="new-subcategory" placeholder="Ex. &quot;Men's Hoodies&quot;">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-default" data-bs-dismiss="modal">Return</button>
          <button id="save-new-subcategory-button-1"
                  class="btn btn-outline-primary"
                  onclick="display_new_subcategory_details()">Save</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="confirm-new-subcategory-modal" tabindex="-1" role="dialog"
       aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Create New Subcategory</h5>
        </div>
        <div class="modal-body">
          Are you sure you want to submit the following details?
          <table class="table">
            <tr>
              <th>New Subcategory Name</th>
              <td id="display-new-subcategory-name"></td>
            </tr>
            <tr>
              <th>For Parent Category</th>
              <td id="display-for-parent-category-name"></td>
            </tr>
          </table>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-default" data-bs-dismiss="modal">Return</button>
          <button id="save-new-subcategory-button-2"
                  class="btn btn-success"
                  onclick="save_new_subcategory()">Save</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="edit-subcategory-modal" aria-hidden="true"
       aria-labelledby="exampleModalToggleLabel" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Edit Subcategory</h5>
        </div>
        <div class="modal-body">
          <table class="table">
            <tr>
              <th>Current Subcategory Name</th>
              <td id="display-current-subcategory-name"></td>
            </tr>
            <tr>
              <th>Enter New Subcategory Name</th>
              <td>
                <input type="text" class="form-control"
                       id="edit-subcategory-input" name="edit-subcategory-input" placeholder="Ex. &quot;Men's Hoodies&quot;">
              </td>
            </tr>
          </table>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-default" data-bs-dismiss="modal">Return</button>
          <button id="edit-new-subcategory-button-1"
                  class="btn btn-outline-primary"
                  onclick="display_edit_subcategory_details()">Save</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="confirm-edit-subcategory-modal" tabindex="-1" role="dialog"
       aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Edit New Subcategory</h5>
        </div>
        <div class="modal-body">
          Are you sure you want to submit the following details?
          <table class="table">
            <tr>
              <th>Currently Stored Subcategory Name</th>
              <td id="display-currently-stored-subcategory-name"></td>
            </tr>
            <tr>
              <th>New Subcategory Name</th>
              <td id="display-new-edit-subcategory-name"></td>
            </tr>
          </table>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-default" data-bs-dismiss="modal">Return</button>
          <button id="save-new-subcategory-button"
                  class="btn btn-success"
                  onclick="save_edit_subcategory()">Save</button>
        </div>
      </div>
    </div>
  </div>
<!-- End Categories-->

<!-- Start Options -->
  <div class="modal fade" id="edit-options-modal" tabindex="-1" role="dialog"
       aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Edit Options</h5>
        </div>
        <div class="modal-body">
          <button class="btn btn-outline-primary btn-sm button-filter expand-option" type="button">Expand All</button>
          <button class="btn btn-outline-primary btn-sm button-filter collapse-option" type="button">Collapse All</button>
          <button class="btn btn-outline-primary btn-sm button-filter"
                  id="create-new-option-button" type="button"
                  data-bs-toggle="modal" data-bs-target="#create-new-option-modal">Create New Option</button>
          <br>
          <br>
          <div class="accordion" id="optionAccordionPanels">
            <div th:if="${#lists.isEmpty(options)}" data-has-none="true">
              No Categories Here
            </div>
            <div th:each="option : ${options}"
                 class="accordion-item"
                 th:id="'option-accordion-'+${option?.getId()}">
              <h2 class="accordion-header"
                  th:id="'panelsStayOpen-heading-'+${optionStat.index}">
                <button class="accordion-button" type="button" data-bs-toggle="collapse"
                        th:id="'option-text-'+${option?.getId()}"
                        th:data-bs-target="'#panelsStayOpen-collapse-'+${optionStat.index}" aria-expanded="true"
                        th:aria-controls="'panelsStayOpen-collapse-'+${optionStat.index}" th:text="${option?.getName()}">
                </button>
              </h2>
              <div th:id="'panelsStayOpen-collapse-'+${optionStat.index}" class="accordion-collapse collapse"
                   th:aria-labelledby="'panelsStayOpen-heading-'+${optionStat.index}">
                <div class="accordion-body">
                  <button type="button" class="btn btn-warning"
                          th:id="'option-edit-text-'+${option?.getId()}"
                          th:text="|Edit &quot${option?.getName()}&quot|"
                          th:data-option-id="${option?.getId()}"
                          onclick="display_edit_option_modal(this)"></button>
                  <button type="button" class="btn btn-danger"
                          th:id="'option-delete-text-'+${option?.getId()}"
                          th:text="|Delete &quot${option?.getName()}&quot|"
                          th:data-id="${option?.getId()}"
                          th:data-type-of-delete="option"
                          th:data-name="${option?.getName()}"
                          onclick="display_delete_modal(this)"></button>
                  <table class="table">
                    <thead>
                    <tr>
                      <th scope="col">Option Values</th>
                      <th scope="col">Edit</th>
                      <th scope="col">Delete</th>
                    </tr>
                    </thead>
                    <tbody th:id="'option-values-table-'+${optionStat.index}">
                    <tr th:if="${#lists.isEmpty(option?.getValues())}" data-has-none="true">
                      <td>No Option Values</td>
                    </tr>
                    <tr th:each="optionValue : ${option?.getValues()}"
                        th:id="'option-value-row-'+${optionValue?.getId()}">
                      <td th:text="${optionValue?.getValue()}" th:id="'option-value-text-'+${optionValue?.getId()}"></td>
                      <td style="padding: 5px;">
                        <button class="btn btn-outline-primary button-edit"
                                type="button" style="font-size: 15px;"
                                th:data-option-id="${option?.getId()}"
                                th:data-option-value-id="${optionValue?.getId()}"
                                onclick="display_edit_option_value_modal(this)">
                          <i class="far fa-edit"></i>
                        </button>
                      </td>
                      <td style="padding: 5px;">
                        <button class="btn btn-outline-primary button-edit"
                                type="button" style="font-size: 15px;"
                                th:data-id="${option?.getId()}+'-'+${optionValue?.getId()}"
                                th:data-type-of-delete="option_value"
                                th:data-name="${optionValue?.getValue()}"
                                onclick="display_delete_modal(this)">
                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                            <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                            <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                          </svg>
                        </button>
                      </td>
                    </tr>
                    </tbody>
                    <tfoot>
                    <tr>
                      <td>
                        <button type="button" class="btn btn-primary" id="add-option-value-button"
                                th:data-option-value-table-id="${optionStat.index}"
                                th:data-option-id="${option?.getId()}"
                                th:data-option-name="${option?.getName()}"
                                onclick="display_create_option_value_modal(this)">+Add Option Value</button>
                      </td>
                    </tr>
                    </tfoot>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-default" data-bs-dismiss="modal">Return</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="create-new-option-modal" aria-hidden="true"
       aria-labelledby="exampleModalToggleLabel" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Create New Option</h5>
        </div>
        <div class="modal-body">
          <label for="new-option-input" class="form-label">Enter New Name</label>
          <input type="text" class="form-control"
                 id="new-option-input" name="new-option-input" placeholder="Ex. &quot;Size&quot;">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-default" data-bs-dismiss="modal">Return</button>
          <button id="save-new-option-button-1"
                  class="btn btn-outline-primary"
                  onclick="display_new_option_details()">Save</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="confirm-option-submit" tabindex="-1" role="dialog"
       aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Confirm Submit</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Are you sure you want to submit the following details?
          <table class="table">
            <tr>
              <th>Option Name</th>
              <td id="display-new-option-name"></td>
            </tr>
          </table>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-default" data-bs-dismiss="modal">Return</button>
          <button id="save-new-option-button-2"
                  class="btn btn-success"
                  onclick="save_new_option()">Save</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="edit-option-modal" aria-hidden="true"
       aria-labelledby="exampleModalToggleLabel" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Edit Option</h5>
        </div>
        <div class="modal-body">
          <table class="table">
            <tr>
              <th>Current Option Name</th>
              <td id="display-current-option-name"></td>
            </tr>
            <tr>
              <th>Enter New Option Name</th>
              <td>
                <input type="text" class="form-control"
                       id="edit-option-input" name="edit-option-input"
                       placeholder="Ex. &quot;Size&quot;">
              </td>
            </tr>
          </table>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-default" data-bs-dismiss="modal">Return</button>
          <button id="edit-option-button-1"
                  class="btn btn-outline-primary"
                  onclick="display_edit_option_details()">Save</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="confirm-edit-option-modal" tabindex="-1" role="dialog"
       aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Edit Option</h5>
        </div>
        <div class="modal-body">
          Are you sure you want to submit the following details?
          <table class="table">
            <tr>
              <th>Currently Stored Option Name</th>
              <td id="display-currently-stored-option-name"></td>
            </tr>
            <tr>
              <th>New Option Name</th>
              <td id="display-new-edit-option-name"></td>
            </tr>
          </table>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-default" data-bs-dismiss="modal">Return</button>
          <button id="edit-option-button-2"
                  class="btn btn-success"
                  onclick="save_edit_option()">Save</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="create-new-option-value-modal" aria-hidden="true"
       aria-labelledby="exampleModalToggleLabel" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Create New Option Value</h5>
        </div>
        <div class="modal-body">
          <label for="new-option-value-input" class="form-label"
                 id="new-option-value-input-label">Enter New Option Value</label>
          <input type="text" class="form-control"
                 id="new-option-value-input" name="new-option-value-input" placeholder="Ex. &quot;Small, Red, Striped...&quot;">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-default" data-bs-dismiss="modal">Return</button>
          <button id="save-new-option-value-button-1"
                  class="btn btn-outline-primary"
                  onclick="display_new_option_value_details()">Save</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="confirm-new-option-value-modal" tabindex="-1" role="dialog"
       aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Create New Option Value</h5>
        </div>
        <div class="modal-body">
          Are you sure you want to submit the following details?
          <table class="table">
            <tr>
              <th>New Option Value</th>
              <td id="display-new-option-value"></td>
            </tr>
            <tr>
              <th>For Option</th>
              <td id="display-for-option-name"></td>
            </tr>
          </table>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-default" data-bs-dismiss="modal">Return</button>
          <button id="save-new-option-value-button-2"
                  class="btn btn-success"
                  onclick="save_new_option_value()">Save</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="edit-option-value-modal" aria-hidden="true"
       aria-labelledby="exampleModalToggleLabel" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Edit Option Value</h5>
        </div>
        <div class="modal-body">
          <table class="table">
            <tr>
              <th>Current Option Value</th>
              <td id="display-current-option-value"></td>
            </tr>
            <tr>
              <th>Enter New Option Value</th>
              <td>
                <input type="text" class="form-control"
                       id="edit-option-value-input" name="edit-option-value-input" placeholder="Ex. &quot;Small, Red, Striped...&quot;">
              </td>
            </tr>
          </table>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-default" data-bs-dismiss="modal">Return</button>
          <button id="edit-new-option-value-button-1"
                  class="btn btn-outline-primary"
                  onclick="display_edit_option_value_details()">Save</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="confirm-edit-option-value-modal" tabindex="-1" role="dialog"
       aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Edit New Option Value</h5>
        </div>
        <div class="modal-body">
          Are you sure you want to submit the following details?
          <table class="table">
            <tr>
              <th>Currently Stored Option Value</th>
              <td id="display-currently-stored-option-value"></td>
            </tr>
            <tr>
              <th>New Option Value</th>
              <td id="display-new-edit-option-value"></td>
            </tr>
          </table>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-default" data-bs-dismiss="modal">Return</button>
          <button id="save-new-option-value-button"
                  class="btn btn-success"
                  onclick="save_edit_option_value()">Save</button>
        </div>
      </div>
    </div>
  </div>
<!-- End Options -->
  <div class="modal fade" id="confirm-delete-modal" tabindex="-1" role="dialog"
       aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="confirm-delete-modal-title"></h5>
        </div>
        <div class="modal-body text-center">
          <span id="confirm-delete-modal-message"></span><br>
          <span>This action CANNOT be undone!</span>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-default" data-bs-dismiss="modal">Return</button>
          <button id="confirm-delete-button"
                  class="btn btn-danger">Delete</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="confirm-create-product-modal" tabindex="-1" role="dialog"
       aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Create Product</h5>
        </div>
        <div class="modal-body">
          Are you sure you want to submit the following details?
          <table class="table">
            <tr>
              <th>Name</th>
              <td id="display-new-name"></td>
            </tr>
            <tr>
              <th>Brand</th>
              <td id="display-new-brand"></td>
            </tr>
            <tr>
              <th>Price</th>
              <td id="display-new-price"></td>
            </tr>
<!--            <tr>-->
<!--              <th>Is Published</th>-->
<!--              <td id="display-new-is-published"></td>-->
<!--            </tr>-->
            <tr>
              <th>Is Big Item</th>
              <td id="display-new-is-big-item"></td>
            </tr>
            <tr>
              <th>Is Waitlistable</th>
              <td id="display-new-is-waitlisted"></td>
            </tr>
            <tr>
              <th>Description</th>
              <td id="display-new-description"></td>
            </tr>
            <tr>
              <th>Category</th>
              <td id="display-new-category"></td>
            </tr>
          </table>
        </div>
        <div class="modal-footer" id="confirm-create-product-modal-footer">

        </div>
      </div>
    </div>
  </div>

  <div class="modal" id="wait-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="wait-modal-title"></h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="d-flex justify-content-center">
            <div class="spinner-border text-success" style="height: 5em; width: 5em;" role="status">
              <span class="sr-only">Loading...</span>
            </div>
          </div>
          <br>
          <div class="justify-content-center">
            Currently saving data...do NOT halt the process by closing or refreshing the tab to ensure full completion!
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="success-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="success-modal-title">Complete</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center">
          <span style="font-size: 35px;font-weight: bold;" id="success-modal-message">Successfully Created</span><br>
          <i class="fa fa-check-circle-o rubberBand animated" style="font-size: 100px;color: rgb(122, 214, 94);height: 41px;"></i>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-default" data-bs-dismiss="modal">Return</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="failed-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="failed-modal-title">Failed</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center">
          <span style="font-size: 35px;font-weight: bold;" id="failed-modal-message-header"></span><br>
          <i class="fa fa-close rubberBand animated" style="font-size: 100px;color: rgb(242, 15, 0);height: 41px;"></i><br>
          <p class="text-start" id="failed-modal-message"></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-default" data-bs-dismiss="modal">Return</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="images-modal" tabindex="-1" role="dialog"
       aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Select Image</h5>
        </div>
        <div class="modal-body" id="images-modal-body">
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-default" data-bs-dismiss="modal">Return</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    /**
     * Upon page load, get all the current categories from the database
     * and load them into the empty <select> tag in the html.
     */
    $(document).ready(function(){
      fill_current_categories();
      fill_options_on_page_load();
    });

    /**
     * Universal Delete Handler
     * Takes in element to be deleted, and dynamically generates confirm-message
     * as well as adding the appropriate delete function to the delete button
     */
    function display_delete_modal(element){
      $('#confirm-delete-modal-title').text("Confirm Delete " + ($(element).data('type-of-delete')).charAt(0).toUpperCase() + ($(element).data('type-of-delete')).slice(1));
      $('#confirm-delete-modal-message').text("Are you sure you want to delete \"" +$(element).data('name')+ "\"");

      $('#confirm-delete-button').removeData('id');
      $('#confirm-delete-button').prop('onclick', null);

      $('#confirm-delete-button').attr('data-id', $(element).data('id'));
      let deleteFunctionName = "delete_".concat($(element).data('type-of-delete').concat("(this)"));
      $('#confirm-delete-button').attr("onclick", deleteFunctionName);

      $('#confirm-delete-modal').modal('show');

    }

    /**
     * Whenever a dropdown option in any select tag is picked,
     * this function marks that option with the attribute "selected".
     * Additionally, any other options have their "selected" attribute removed.
     */
    $(document).on("change","select",function(){
      $("option[value=" + this.value + "]", this)
              .attr("selected", true).siblings()
              .removeAttr("selected");
    });

    var testing;
    /**
     * Gets all current attributes from the database. If:
     * (1) - There are no categories, dont let them submit at all
     * (2) - Load all the existing categories into the <select> tags
     */
    function fill_current_categories(){
      $.ajax({
        type: "GET",
        url: '/api/secured/categories/',
        beforeSend: function(xhr) {
          // xhr.setRequestHeader(
          //         $('meta[name=_csrf_header]').attr('content'),
          //         $('meta[name=_csrf]').attr('content')
          // )
        },
        success: function(data)
        {
          if(jQuery.isEmptyObject(data['categories'])){
            $("#submit-create-product-group").prop("disabled", true);
            $('#if-no-categories').css("display", "");
          }
          else{
            $('#if-no-categories').css("display", "none");
            $('#categories').empty();
            for(let i = 0; i < data['categories'].length; i++){
              if(data['categories'][i]['parent'] === null){
                if(i === 0){
                  $('#categories').append($('<option>', {
                    selected: true,
                    value: data['categories'][i]['id'],
                    text : data['categories'][i]['name']
                  }));
                }
                else{
                  $('#categories').append($('<option>', {
                    value: data['categories'][i]['id'],
                    text : data['categories'][i]['name']
                  }));
                }
                $('#categories option:last').css('background-color', '#f5f5f5');
                let subcategoriesList = data['categories'][i]['subcategories'];
                for(let i = 0; i < subcategoriesList.length; i++){
                  $('#categories').append($('<option>', {
                    value: subcategoriesList[i]['id'],
                    text : " - " + subcategoriesList[i]['name']
                  }));
                }
              }
            }
          }
        },
        error: function(xhr) {
          console.log(xhr);
          testing = xhr;
          $('#wait-modal').modal('hide');

          $('#failed-modal-message-header').text("Data Retrieval Failed");
          var responseMessagesString = '';
          let responseMessages = xhr.responseJSON['messages'];

          if (responseMessages !== undefined) {
            for (let i = 0; i < responseMessages.length; i++) {
              responseMessagesString += ((i + 1) + ". " + responseMessages[i]['message'] + "\n");
            }
            $('#failed-modal-message').text("Error Message: \n" + responseMessagesString);
          } else {
            $('#failed-modal-message').text("Error Message: \nNo available Error Message.");
          }

          $('#failed-modal').modal('show');
        }
      });
    }

    function delete_category(element){
      $.ajax({
        type: "DELETE",
        url: '/api/secured/categories/'.concat($(element).data('id')),
        beforeSend: function(xhr) {
          // xhr.setRequestHeader(
          //         $('meta[name=_csrf_header]').attr('content'),
          //         $('meta[name=_csrf]').attr('content')
          // )
          $('#confirm-delete-modal').modal('hide');

          $('#wait-modal-title').text("Deleting Parent Category...");
          $('#wait-modal').modal('show');
        },
        success: function(data)
        {
          $('#wait-modal').modal('hide');


          $('#category-accordion-'+$(element).data('id')).remove();

          if(!($('#categoryAccordionPanels').children().length > 0)){
            let noCategoriesDiv = `
              <div data-has-none="true">
                No Categories Here
              </div>
            `;

            $('#categoryAccordionPanels').append(noCategoriesDiv);
          }

          $('#success-modal-message').text("Successfully deleted Parent Category");
          $('#success-modal').modal('show');


          fill_current_categories();
        },
        error: function(xhr) {
          console.log(xhr);
          testing = xhr;
          $('#wait-modal').modal('hide');

          $('#failed-modal-message-header').text("Delete Failed");
          var responseMessagesString = '';
          let responseMessages = xhr.responseJSON['messages'];

          if (responseMessages !== undefined) {
            for (let i = 0; i < responseMessages.length; i++) {
              responseMessagesString += ((i + 1) + ". " + responseMessages[i]['message'] + "\n");
            }
            $('#failed-modal-message').text("Error Message: \n" + responseMessagesString);
          } else {
            $('#failed-modal-message').text("Error Message: \nNo available Error Message.");
          }

          $('#failed-modal').modal('show');
        }
      });
    }

    /**
     * Create Parent Category Part 1 of 2
    */
    function display_new_parent_category_details(){
      $('#display-new-parent-category-name').text($('#new-parent-category-input').val());
      $('#confirm-parent-category-submit').modal('show');
    }

    var parentCategorySecondaryCounter = 0;

    /**
     * Create Parent Category Part 2 of 2
    */
     function save_new_parent_category(){
      const data = {
        'name': $('#new-parent-category-input').val().trim(),
        'parentId': null
      };

      $.ajax({
        type: "POST",
        url: '/api/secured/categories',
        contentType: "application/json",
        data: JSON.stringify(data), // serializes the form's elements.
        beforeSend: function(xhr) {
          // xhr.setRequestHeader(
          //         $('meta[name=_csrf_header]').attr('content'),
          //         $('meta[name=_csrf]').attr('content')
          // )
          $('#create-new-parent-category-modal').modal('hide');
          $('#confirm-parent-category-submit').modal('hide');

          $('#wait-modal-title').text("Saving Parent Category...");
          $('#wait-modal').modal('show');
        },
        success: function(data)
        {
          $('#wait-modal').modal('hide');

          parentCategorySecondaryCounter--;

          let newAccordionItem = `
              <div class="accordion-item"
                 id="category-accordion-${data.id}">
              <h2 class="accordion-header"
                  id="panelsStayOpen-heading-${parentCategorySecondaryCounter}">
                <button class="accordion-button" type="button" data-bs-toggle="collapse"
                        id="parent-category-text-${data.id}"
                        data-bs-target="#panelsStayOpen-collapse-${parentCategorySecondaryCounter}" aria-expanded="true"
                        aria-controls="panelsStayOpen-collapse-${parentCategorySecondaryCounter}">${data.name}
                </button>
              </h2>
              <div id="panelsStayOpen-collapse-${parentCategorySecondaryCounter}" class="accordion-collapse collapse"
                   aria-labelledby="panelsStayOpen-heading-${parentCategorySecondaryCounter}">
                <div class="accordion-body">
                  <button type="button" class="btn btn-warning"
                          id="parent-category-edit-text-${data.id}"
                          data-cat-id="${data.id}"
                          onclick="display_edit_parent_category_modal(this)">Edit &quot;${data.name}&quot;</button>
                  <button type="button" class="btn btn-danger"
                          id="parent-category-delete-text-${data.id}"
                          data-id="${data.id}"
                          data-type-of-delete="category"
                          data-name="${data.name}"
                          onclick="display_delete_modal(this)">Delete &quot;${data.name}&quot;</button>
                  <table class="table">
                    <thead>
                      <tr>
                        <th scope="col">Subcategory</th>
                        <th scope="col">Edit</th>
                        <th scope="col">Delete</th>
                      </tr>
                    </thead>
                    <tbody id="subcategory-table-${parentCategorySecondaryCounter}">
                      <tr data-has-none="true">
                        <td>No Subcategories</td>
                      </tr>
                    </tbody>
                    <tfoot>
                      <tr>
                        <td>
                          <button type="button" class="btn btn-primary" id="add-sub-cat-button"
                                  data-subcat-table-id="${parentCategorySecondaryCounter}"
                                  data-parent-cat-id="${data.id}"
                                  data-parent-cat-name="${data.name}"
                                  onclick="display_create_subcategory_modal(this)">+Add Subcategory</button>
                        </td>
                      </tr>
                    </tfoot>
                  </table>
                </div>
              </div>
            </div>
          `;

          $('#categoryAccordionPanels').append(newAccordionItem);

          $('#success-modal-message').text("Successfully created new Parent Category - \"" + data['name'] + "\"");
          $('#success-modal').modal('show');


          fill_current_categories();


        },
        error: function(xhr) {
          console.log(xhr);
          testing = xhr;
          $('#wait-modal').modal('hide');

          $('#failed-modal-message-header').text("Creation Failed");
          var responseMessagesString = '';
          let responseMessages = xhr.responseJSON['messages'];

          if (responseMessages !== undefined) {
            for (let i = 0; i < responseMessages.length; i++) {
              responseMessagesString += ((i + 1) + ". " + responseMessages[i]['message'] + "\n");
            }
            $('#failed-modal-message').text("Error Message: \n" + responseMessagesString);
          } else {
            $('#failed-modal-message').text("Error Message: \nNo available Error Message.");
          }

          $('#failed-modal').modal('show');
        }
      });
    }

    /**
     * Edit Parent Category Part 1 of 3
     */
    function display_edit_parent_category_modal(element){
      $.ajax({
        type: "GET",
        url: '/api/secured/categories/'.concat($(element).data("cat-id")),
        success: function(data)
        {
          $('#display-current-parent-category-name').text(data['name']);

          $('#edit-parent-category-input').removeData('cat-id');
          $('#edit-parent-category-input').attr('data-cat-id', $(element).data("cat-id"));

          $('#edit-parent-category-modal').modal('show');
        },
        error: function(xhr) {
          console.log(xhr);
          testing = xhr;
          $('#wait-modal').modal('hide');

          $('#failed-modal-message-header').text("Data Retrieval Failed");
          var responseMessagesString = '';
          let responseMessages = xhr.responseJSON['messages'];

          if (responseMessages !== undefined) {
            for (let i = 0; i < responseMessages.length; i++) {
              responseMessagesString += ((i + 1) + ". " + responseMessages[i]['message'] + "\n");
            }
            $('#failed-modal-message').text("Error Message: \n" + responseMessagesString);
          } else {
            $('#failed-modal-message').text("Error Message: \nNo available Error Message.");
          }

          $('#failed-modal').modal('show');
        }
      });
    }

    /**
     * Edit Parent Category Part 2 of 3
     */
    function display_edit_parent_category_details(){
      $.ajax({
        type: "GET",
        url: '/api/secured/categories/'.concat($('#edit-parent-category-input').data("cat-id")),
        success: function(data)
        {
          $('#display-currently-stored-parent-category-name').text(data['name']);
          $('#display-new-edit-parent-category-name').text($('#edit-parent-category-input').val());

          $('#confirm-edit-parent-category-modal').modal('show');
        },
        error: function(xhr) {
          console.log(xhr);
          testing = xhr;
          $('#wait-modal').modal('hide');

          $('#failed-modal-message-header').text("Data Retrieval Failed");
          var responseMessagesString = '';
          let responseMessages = xhr.responseJSON['messages'];

          if (responseMessages !== undefined) {
            for (let i = 0; i < responseMessages.length; i++) {
              responseMessagesString += ((i + 1) + ". " + responseMessages[i]['message'] + "\n");
            }
            $('#failed-modal-message').text("Error Message: \n" + responseMessagesString);
          } else {
            $('#failed-modal-message').text("Error Message: \nNo available Error Message.");
          }

          $('#failed-modal').modal('show');
        }
      });
    }

    /**
     * Edit Parent Category Part 3 of 3
     */
    function save_edit_parent_category(){
      const data = {
        'name': $('#edit-parent-category-input').val().trim()
      };

      $.ajax({
        type: "PATCH",
        url: '/api/secured/categories/'.concat($('#edit-parent-category-input').data("cat-id")),
        contentType: "application/json",
        data: JSON.stringify(data), // serializes the form's elements.
        beforeSend: function(xhr) {
          // xhr.setRequestHeader(
          //         $('meta[name=_csrf_header]').attr('content'),
          //         $('meta[name=_csrf]').attr('content')
          // )
          $('#edit-parent-category-modal').modal('hide');
          $('#confirm-edit-parent-category-modal').modal('hide');

          $('#wait-modal-title').text("Saving Category...");
          $('#wait-modal').modal('show');
        },
        success: function(data)
        {
          console.log(data);
          $('#wait-modal').modal('hide');

          let oldName = $('#parent-category-text-'+data['id']).text();
          $('#parent-category-text-'+data['id']).text(data['name']);
          $('#parent-category-edit-text-'+data['id']).text("Edit \""+data['name']+"\"");
          $('#parent-category-delete-text-'+data['id']).text("Delete \""+data['name']+"\"");
          $('#parent-category-delete-text-'+data['id']).removeData('name');
          $('#parent-category-delete-text-'+data['id']).attr("data-name", data['name']);


          $('#success-modal-message').text("Successfully edited Parent Category - \"" + oldName + "\" to - \"" + data['name'] + "\"");
          $('#success-modal').modal('show');


          fill_current_categories();
        },
        error: function(xhr) {
          console.log(xhr);
          testing = xhr;
          $('#wait-modal').modal('hide');

          $('#failed-modal-message-header').text("Edit Failed");
          var responseMessagesString = '';
          let responseMessages = xhr.responseJSON['messages'];

          if (responseMessages !== undefined) {
            for (let i = 0; i < responseMessages.length; i++) {
              responseMessagesString += ((i + 1) + ". " + responseMessages[i]['message'] + "\n");
            }
            $('#failed-modal-message').text("Error Message: \n" + responseMessagesString);
          } else {
            $('#failed-modal-message').text("Error Message: \nNo available Error Message.");
          }

          $('#failed-modal').modal('show');
        }
      });
    }

    /**
     * Create Subcategory Part 1 of 3
    */
    function display_create_subcategory_modal(element){
      $('#new-subcategory-input-label').text("Enter New Subcategory Name for Parent Category \""+$(element).data('parent-cat-name')+"\"");

      $('#new-subcategory-input').removeData('subcat-table-id');
      $('#new-subcategory-input').removeData('parent-cat-id');
      $('#new-subcategory-input').removeData('parent-cat-name');

      $('#new-subcategory-input').attr('data-subcat-table-id', $(element).data("subcat-table-id"));
      $('#new-subcategory-input').attr('data-parent-cat-id', $(element).data("parent-cat-id"));
      $('#new-subcategory-input').attr('data-parent-cat-name', $(element).data("parent-cat-name"));

      $('#create-new-subcategory-modal').modal('show');
    }

    /**
     * Create Subcategory Part 2 of 3
     */
    function display_new_subcategory_details(element){
      $('#display-new-subcategory-name').text($('#new-subcategory-input').val());
      $('#display-for-parent-category-name').text($('#new-subcategory-input').data("parent-cat-name"));

      $('#confirm-new-subcategory-modal').modal('show');
    }

    var subcategorySecondaryCounter = 0;

    /**
     * Create Subcategory Part 3 of 3
     */
    function save_new_subcategory() {
      const data = {
        'name': $('#new-subcategory-input').val().trim(),
        'parentId': $('#new-subcategory-input').data('parent-cat-id')
      };

      console.log("POST Subcategory Data:");
      console.log(data);

      $.ajax({
        type: "POST",
        url: '/api/secured/categories',
        contentType: "application/json",
        data: JSON.stringify(data), // serializes the form's elements.
        beforeSend: function(xhr) {
          // xhr.setRequestHeader(
          //         $('meta[name=_csrf_header]').attr('content'),
          //         $('meta[name=_csrf]').attr('content')
          // )
          $('#create-new-subcategory-modal').modal('hide');
          $('#confirm-new-subcategory-modal').modal('hide');

          $('#wait-modal-title').text("Saving Subcategory...");
          $('#wait-modal').modal('show');
        },
        success: function(data)
        {
          console.log(data);
          $('#wait-modal').modal('hide');

          subcategorySecondaryCounter--;

          let subcategoryRow = `
                 <tr id="subcategory-row-${data.id}">
                     <td id="subcategory-text-${data.id}">
                        ${data.name}
                     </td>
                     <td style="padding: 5px;">
                            <button class="btn btn-outline-primary button-edit"
                                    type="button" style="font-size: 15px;"
                                    data-subcat-id="${data.id}"
                                    onclick="display_edit_subcategory_modal(this)">
                              <i class="far fa-edit"></i>
                            </button>
                     </td>
                     <td style="padding: 5px;">
                          <button class="btn btn-outline-primary button-edit"
                                  type="button" style="font-size: 15px;"
                                  data-id="${data.id}"
                                  data-type-of-delete="subcategory"
                                  data-name="${data.name}"
                                  onclick="display_delete_modal(this)">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                              <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                              <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                            </svg>
                          </button>
                     </td>
                 </tr>
          `;

          let subcatTableId = $('#new-subcategory-input').data("subcat-table-id");
          if($($('#subcategory-table-'+subcatTableId).children()[0]).data('has-none') === true){
            $("#subcategory-table-"+subcatTableId).html(subcategoryRow);
          }
          else{
            $("#subcategory-table-"+subcatTableId).append(subcategoryRow);
          }

          $('#success-modal-message').text("Successfully created new Subcategory - \"" + data['name'] + "\" for Parent Category - \"" + data['parent']['name'] + "\"");
          $('#success-modal').modal('show');


          fill_current_categories();
        },
        error: function(xhr) {
          console.log(xhr);
          testing = xhr;
          $('#wait-modal').modal('hide');

          $('#failed-modal-message-header').text("Creation Failed");
          var responseMessagesString = '';
          let responseMessages = xhr.responseJSON['messages'];

          if (responseMessages !== undefined) {
            for (let i = 0; i < responseMessages.length; i++) {
              responseMessagesString += ((i + 1) + ". " + responseMessages[i]['message'] + "\n");
            }
            $('#failed-modal-message').text("Error Message: \n" + responseMessagesString);
          } else {
            $('#failed-modal-message').text("Error Message: \nNo available Error Message.");
          }

          $('#failed-modal').modal('show');
        }
      });
    }

    /**
     * Edit Subcategory Part 1 of 3
     */
    function display_edit_subcategory_modal(element){
      $.ajax({
        type: "GET",
        url: '/api/secured/categories/'.concat($(element).data("subcat-id")),
        success: function(data)
        {
          $('#display-current-subcategory-name').text(data['name']);

          $('#edit-subcategory-input').removeData('subcat-id');
          $('#edit-subcategory-input').attr('data-subcat-id', $(element).data("subcat-id"));

          $('#edit-subcategory-modal').modal('show');
        },
        error: function(xhr) {
          console.log(xhr);
          testing = xhr;
          $('#wait-modal').modal('hide');

          $('#failed-modal-message-header').text("Data Retrieval Failed");
          var responseMessagesString = '';
          let responseMessages = xhr.responseJSON['messages'];

          if (responseMessages !== undefined) {
            for (let i = 0; i < responseMessages.length; i++) {
              responseMessagesString += ((i + 1) + ". " + responseMessages[i]['message'] + "\n");
            }
            $('#failed-modal-message').text("Error Message: \n" + responseMessagesString);
          } else {
            $('#failed-modal-message').text("Error Message: \nNo available Error Message.");
          }

          $('#failed-modal').modal('show');
        }
      });
    }

    /**
     * Edit Parent Category Part 2 of 3
     */
    function display_edit_subcategory_details(){
      $.ajax({
        type: "GET",
        url: '/api/secured/categories/'.concat($('#edit-subcategory-input').data("subcat-id")),
        success: function(data)
        {
          $('#display-currently-stored-subcategory-name').text(data['name']);
          $('#display-new-edit-subcategory-name').text($('#edit-subcategory-input').val());

          $('#confirm-edit-subcategory-modal').modal('show');
        },
        error: function(xhr) {
          console.log(xhr);
          testing = xhr;
          $('#wait-modal').modal('hide');

          $('#failed-modal-message-header').text("Data Retrieval Failed");
          var responseMessagesString = '';
          let responseMessages = xhr.responseJSON['messages'];

          if (responseMessages !== undefined) {
            for (let i = 0; i < responseMessages.length; i++) {
              responseMessagesString += ((i + 1) + ". " + responseMessages[i]['message'] + "\n");
            }
            $('#failed-modal-message').text("Error Message: \n" + responseMessagesString);
          } else {
            $('#failed-modal-message').text("Error Message: \nNo available Error Message.");
          }

          $('#failed-modal').modal('show');
        }
      });
    }

    /**
     * Edit Parent Category Part 3 of 3
     */
    function save_edit_subcategory(){
      const data = {
        'name': $('#edit-subcategory-input').val().trim()
      };

      $.ajax({
        type: "PATCH",
        url: '/api/secured/categories/'.concat($('#edit-subcategory-input').data("subcat-id")),
        contentType: "application/json",
        data: JSON.stringify(data), // serializes the form's elements.
        beforeSend: function(xhr) {
          // xhr.setRequestHeader(
          //         $('meta[name=_csrf_header]').attr('content'),
          //         $('meta[name=_csrf]').attr('content')
          // )
          $('#edit-subcategory-modal').modal('hide');
          $('#confirm-edit-subcategory-modal').modal('hide');

          $('#wait-modal-title').text("Saving Subcategory...");
          $('#wait-modal').modal('show');
        },
        success: function(data)
        {
          console.log(data);
          $('#wait-modal').modal('hide');

          let oldName = $('#subcategory-text-'+data['id']).text();
          $('#subcategory-text-'+data['id']).text(data['name']);
          $($('#subcategory-text-'+data['id']).next().next().children()[0]).removeData('name');
          $($('#subcategory-text-'+data['id']).next().next().children()[0]).attr('data-name', data['name']);



          $('#success-modal-message').text("Successfully edited Subcategory - \"" + oldName + "\" to - \"" + data['name'] + "\"");
          $('#success-modal').modal('show');


          fill_current_categories();
        },
        error: function(xhr) {
          console.log(xhr);
          testing = xhr;
          $('#wait-modal').modal('hide');

          $('#failed-modal-message-header').text("Edit Failed");
          var responseMessagesString = '';
          let responseMessages = xhr.responseJSON['messages'];

          if (responseMessages !== undefined) {
            for (let i = 0; i < responseMessages.length; i++) {
              responseMessagesString += ((i + 1) + ". " + responseMessages[i]['message'] + "\n");
            }
            $('#failed-modal-message').text("Error Message: \n" + responseMessagesString);
          } else {
            $('#failed-modal-message').text("Error Message: \nNo available Error Message.");
          }

          $('#failed-modal').modal('show');
        }
      });

    }

    function delete_subcategory(element){
      $.ajax({
        type: "DELETE",
        url: '/api/secured/categories/'.concat($(element).data('id')),
        beforeSend: function(xhr) {
          // xhr.setRequestHeader(
          //         $('meta[name=_csrf_header]').attr('content'),
          //         $('meta[name=_csrf]').attr('content')
          // )
          $('#confirm-delete-modal').modal('hide');

          $('#wait-modal-title').text("Deleting Subcategory...");
          $('#wait-modal').modal('show');
        },
        success: function(data)
        {
          $('#wait-modal').modal('hide');

          $('#subcategory-row-'+$(element).data('id')).remove();

          // if(!($('#categoryAccordionPanels').children().length > 0)){
          //   let noSubcategoriesDiv = `
          //     <tr data-has-none="true">
          //        <td>No Subcategories</td>
          //      </tr>
          //   `;
          //   $('#categoryAccordionPanels').append(noSubcategoriesDiv);
          // }

          $('#success-modal-message').text("Successfully deleted Subcategory");
          $('#success-modal').modal('show');


          fill_current_categories();
        },
        error: function(xhr) {
          $('#wait-modal').modal('hide');

          $('#failed-modal-message-header').text("Delete Failed");
          var responseMessagesString = '';
          let responseMessages = xhr.responseJSON['messages'];
          console.log(xhr);
          testing = xhr;
          if (responseMessages !== undefined) {
            for (let i = 0; i < responseMessages.length; i++) {
              responseMessagesString += ((i + 1) + ". " + responseMessages[i]['message'] + "\n");
            }
            $('#failed-modal-message').text("Error Message: \n" + responseMessagesString);
          } else {
            $('#failed-modal-message').text("Error Message: \nNo available Error Message.");
          }

          $('#failed-modal').modal('show');
        }
      });
    }





    /*
    Clicking on the expand button, expands all groups
    */
    $('.expand-option').on('click', function() {
      $('.accordion-button').removeClass('collpased');
      $('.accordion-collapse').collapse('show');
    });

    /*
    Clicking on the collapse button, collapses all groups
    */
    $('.collapse-option').on('click', function() {
      $('.accordion-button').addClass('collpased');
      $('.accordion-collapse').collapse('hide');
    });

    /*
    Expand all accordions by default
    */
    $('#edit-categories-modal-button').on('click', function() {
      $('.accordion-button').removeClass('collpased');
      $('.accordion-collapse').collapse('show');
    });

    //End Categories
    //-----------------------------------------------------------------------------------------------------------------------
    //Start Options

    /**
     * Gets all current attributes from the database. If:
     * (1) - There are no categories, dont let them submit at all
     * (2) - Load all the existing categories into the <select> tags
     */
    // function fill_current_categories(){
    //   $.ajax({
    //     type: "GET",
    //     url: '/api/secured/categories/',
    //     beforeSend: function(xhr) {
    //       // xhr.setRequestHeader(
    //       //         $('meta[name=_csrf_header]').attr('content'),
    //       //         $('meta[name=_csrf]').attr('content')
    //       // )
    //     },
    //     success: function(data)
    //     {
    //       if(jQuery.isEmptyObject(data['categories'])){
    //         $("#submit-create-product-group").prop("disabled", true);
    //         $('#if-no-categories').css("display", "");
    //       }
    //       else{
    //         $('#if-no-categories').css("display", "none");
    //         $('#categories').empty();
    //         for(let i = 0; i < data['categories'].length; i++){
    //           if(data['categories'][i]['parent'] === null){
    //             if(i === 0){
    //               $('#categories').append($('<option>', {
    //                 selected: true,
    //                 value: data['categories'][i]['id'],
    //                 text : data['categories'][i]['name']
    //               }));
    //             }
    //             else{
    //               $('#categories').append($('<option>', {
    //                 value: data['categories'][i]['id'],
    //                 text : data['categories'][i]['name']
    //               }));
    //             }
    //             $('#categories option:last').css('background-color', '#f5f5f5');
    //             let subcategoriesList = data['categories'][i]['subcategories'];
    //             for(let i = 0; i < subcategoriesList.length; i++){
    //               $('#categories').append($('<option>', {
    //                 value: subcategoriesList[i]['id'],
    //                 text : " - " + subcategoriesList[i]['name']
    //               }));
    //             }
    //           }
    //         }
    //       }
    //     },
    //     error: function(xhr) {
    //       console.log(xhr);
    //       testing = xhr;
    //       $('#wait-modal').modal('hide');
    //
    //       $('#failed-modal-message-header').text("Data Retrieval Failed");
    //       var responseMessagesString = '';
    //       let responseMessages = xhr.responseJSON['messages'];
    //
    //       if (responseMessages !== undefined) {
    //         for (let i = 0; i < responseMessages.length; i++) {
    //           responseMessagesString += ((i + 1) + ". " + responseMessages[i]['message'] + "\n");
    //         }
    //         $('#failed-modal-message').text("Error Message: \n" + responseMessagesString);
    //       } else {
    //         $('#failed-modal-message').text("Error Message: \nNo available Error Message.");
    //       }
    //
    //       $('#failed-modal').modal('show');
    //     }
    //   });
    // }

    function delete_option(element){
      alert('Function Not Implemented Yet!');
      return;
      $.ajax({
        type: "DELETE",
        url: '/api/secured/options/'.concat($(element).data('id')),
        beforeSend: function(xhr) {
          // xhr.setRequestHeader(
          //         $('meta[name=_csrf_header]').attr('content'),
          //         $('meta[name=_csrf]').attr('content')
          // )
          $('#confirm-delete-modal').modal('hide');

          $('#wait-modal-title').text("Deleting Option...");
          $('#wait-modal').modal('show');
        },
        success: function(data)
        {
          $('#wait-modal').modal('hide');


          $('#option-accordion-'+$(element).data('id')).remove();

          if(!($('#optionAccordionPanels').children().length > 0)){
            let noOptionsDiv = `
              <div data-has-none="true">
                No Options Here
              </div>
            `;

            $('#optionAccordionPanels').append(noOptionsDiv);
          }

          $('#success-modal-message').text("Successfully deleted Option");
          $('#success-modal').modal('show');


          //fill_current_categories();
        },
        error: function(xhr) {
          console.log(xhr);
          testing = xhr;
          $('#wait-modal').modal('hide');

          $('#failed-modal-message-header').text("Delete Failed");
          var responseMessagesString = '';
          let responseMessages = xhr.responseJSON['messages'];

          if (responseMessages !== undefined) {
            for (let i = 0; i < responseMessages.length; i++) {
              responseMessagesString += ((i + 1) + ". " + responseMessages[i]['message'] + "\n");
            }
            $('#failed-modal-message').text("Error Message: \n" + responseMessagesString);
          } else {
            $('#failed-modal-message').text("Error Message: \nNo available Error Message.");
          }

          $('#failed-modal').modal('show');
        }
      });
    }

    /**
     * Create Option Part 1 of 2
     */
    function display_new_option_details(){
      $('#display-new-option-name').text($('#new-option-input').val());
      $('#confirm-option-submit').modal('show');
    }

    var optionSecondaryCounter = 0;

    /**
     * Create Parent Category Part 2 of 2
     */
    function save_new_option(){
      const data = {
        'name': $('#new-option-input').val().trim()
      }

      $.ajax({
        type: "POST",
        url: '/api/secured/options',
        contentType: "application/json",
        data: JSON.stringify(data), // serializes the form's elements.
        beforeSend: function(xhr) {
          // xhr.setRequestHeader(
          //         $('meta[name=_csrf_header]').attr('content'),
          //         $('meta[name=_csrf]').attr('content')
          // )
          $('#create-new-option-modal').modal('hide');
          $('#confirm-option-submit').modal('hide');

          $('#wait-modal-title').text("Saving Option...");
          $('#wait-modal').modal('show');
        },
        success: function(data)
        {
          $('#wait-modal').modal('hide');

          optionSecondaryCounter--;

          let newAccordionItem = `
              <div class="accordion-item"
                 id="option-accordion-${data.id}">
              <h2 class="accordion-header"
                  id="panelsStayOpen-heading-${parentCategorySecondaryCounter}">
                <button class="accordion-button" type="button" data-bs-toggle="collapse"
                        id="option-text-${data.id}"
                        data-bs-target="#panelsStayOpen-collapse-${parentCategorySecondaryCounter}" aria-expanded="true"
                        aria-controls="panelsStayOpen-collapse-${parentCategorySecondaryCounter}">${data.name}
                </button>
              </h2>
              <div id="panelsStayOpen-collapse-${parentCategorySecondaryCounter}" class="accordion-collapse collapse"
                   aria-labelledby="panelsStayOpen-heading-${parentCategorySecondaryCounter}">
                <div class="accordion-body">
                  <button type="button" class="btn btn-warning"
                          id="option-edit-text-${data.id}"
                          data-option-id="${data.id}"
                          onclick="display_edit_option_modal(this)">Edit &quot;${data.name}&quot;</button>
                  <button type="button" class="btn btn-danger"
                          id="option-delete-text-${data.id}"
                          data-id="${data.id}"
                          data-type-of-delete="option"
                          data-name="${data.name}"
                          onclick="display_delete_modal(this)">Delete &quot;${data.name}&quot;</button>
                  <table class="table">
                    <thead>
                      <tr>
                        <th scope="col">Option Values</th>
                        <th scope="col">Edit</th>
                        <th scope="col">Delete</th>
                      </tr>
                    </thead>
                    <tbody id="option-values-table-${parentCategorySecondaryCounter}">
                      <tr data-has-none="true">
                        <td>No Option Values</td>
                      </tr>
                    </tbody>
                    <tfoot>
                      <tr>
                        <td>
                          <button type="button" class="btn btn-primary" id="add-option-value-button"
                                  data-option-value-table-id="${parentCategorySecondaryCounter}"
                                  data-option-id="${data.id}"
                                  data-option-name="${data.name}"
                                  onclick="display_create_option_value_modal(this)">+Add Option Value</button>
                        </td>
                      </tr>
                    </tfoot>
                  </table>
                </div>
              </div>
            </div>
          `;

          $('#optionAccordionPanels').append(newAccordionItem);

          $('#success-modal-message').text("Successfully created new Option - \"" + data['name'] + "\"");
          $('#success-modal').modal('show');


          //fill_current_categories();
        },
        error: function(xhr) {
          console.log(xhr);
          testing = xhr;
          $('#wait-modal').modal('hide');

          $('#failed-modal-message-header').text("Creation Failed");
          var responseMessagesString = '';
          let responseMessages = xhr.responseJSON['messages'];

          if (responseMessages !== undefined) {
            for (let i = 0; i < responseMessages.length; i++) {
              responseMessagesString += ((i + 1) + ". " + responseMessages[i]['message'] + "\n");
            }
            $('#failed-modal-message').text("Error Message: \n" + responseMessagesString);
          } else {
            $('#failed-modal-message').text("Error Message: \nNo available Error Message.");
          }

          $('#failed-modal').modal('show');
        }
      });
    }

    /**
     * Edit Parent Category Part 1 of 3
     */
    function display_edit_option_modal(element){
      $.ajax({
        type: "GET",
        url: '/api/secured/options/'.concat($(element).data("option-id")),
        success: function(data)
        {
          $('#display-current-option-name').text(data['name']);

          $('#edit-option-input').removeData('option-id');
          $('#edit-option-input').attr('data-option-id', $(element).data("option-id"));

          $('#edit-option-modal').modal('show');
        },
        error: function(xhr) {
          console.log(xhr);
          testing = xhr;
          $('#wait-modal').modal('hide');

          $('#failed-modal-message-header').text("Data Retrieval Failed");
          var responseMessagesString = '';
          let responseMessages = xhr.responseJSON['messages'];

          if (responseMessages !== undefined) {
            for (let i = 0; i < responseMessages.length; i++) {
              responseMessagesString += ((i + 1) + ". " + responseMessages[i]['message'] + "\n");
            }
            $('#failed-modal-message').text("Error Message: \n" + responseMessagesString);
          } else {
            $('#failed-modal-message').text("Error Message: \nNo available Error Message.");
          }

          $('#failed-modal').modal('show');
        }
      });
    }

    /**
     * Edit Parent Category Part 2 of 3
     */
    function display_edit_option_details(){
      $.ajax({
        type: "GET",
        url: '/api/secured/options/'.concat($('#edit-option-input').data("option-id")),
        success: function(data)
        {
          $('#display-currently-stored-option-name').text(data['name'])
          $('#display-new-edit-option-name').text($('#edit-option-input').val());

          $('#confirm-edit-option-modal').modal('show');
        },
        error: function(xhr) {
          console.log(xhr);
          testing = xhr;
          $('#wait-modal').modal('hide');

          $('#failed-modal-message-header').text("Data Retrieval Failed");
          var responseMessagesString = '';
          let responseMessages = xhr.responseJSON['messages'];

          if (responseMessages !== undefined) {
            for (let i = 0; i < responseMessages.length; i++) {
              responseMessagesString += ((i + 1) + ". " + responseMessages[i]['message'] + "\n");
            }
            $('#failed-modal-message').text("Error Message: \n" + responseMessagesString);
          } else {
            $('#failed-modal-message').text("Error Message: \nNo available Error Message.");
          }

          $('#failed-modal').modal('show');
        }
      });
    }

    /**
     * Edit Parent Category Part 3 of 3
     */
    function save_edit_option(){
      const data = {
        'name': $('#edit-option-input').val().trim()
      };

      $.ajax({
        type: "PATCH",
        url: '/api/secured/options/'.concat($('#edit-option-input').data("option-id")),
        contentType: "application/json",
        data: JSON.stringify(data), // serializes the form's elements.
        beforeSend: function(xhr) {
          // xhr.setRequestHeader(
          //         $('meta[name=_csrf_header]').attr('content'),
          //         $('meta[name=_csrf]').attr('content')
          // )
          $('#edit-option-modal').modal('hide');
          $('#confirm-edit-option-modal').modal('hide');

          $('#wait-modal-title').text("Saving Option...");
          $('#wait-modal').modal('show');
        },
        success: function(data)
        {
          console.log(data);
          $('#wait-modal').modal('hide');

          let oldName = $('#option-text-'+data['id']).text();
          $('#option-text-'+data['id']).text(data['name']);
          $('#option-edit-text-'+data['id']).text("Edit \""+data['name']+"\"");
          $('#option-delete-text-'+data['id']).text("Delete \""+data['name']+"\"");
          $('#option-delete-text-'+data['id']).removeData('name');
          $('#option-delete-text-'+data['id']).attr('data-name', data['name']);


          $('#success-modal-message').text("Successfully edited Option - \"" + oldName + "\" to - \"" + data['name'] + "\"");
          $('#success-modal').modal('show');


          //fill_current_categories();
        },
        error: function(xhr) {
          console.log(xhr);
          testing = xhr;
          $('#wait-modal').modal('hide');

          $('#failed-modal-message-header').text("Edit Failed");
          var responseMessagesString = '';
          let responseMessages = xhr.responseJSON['messages'];

          if (responseMessages !== undefined) {
            for (let i = 0; i < responseMessages.length; i++) {
              responseMessagesString += ((i + 1) + ". " + responseMessages[i]['message'] + "\n");
            }
            $('#failed-modal-message').text("Error Message: \n" + responseMessagesString);
          } else {
            $('#failed-modal-message').text("Error Message: \nNo available Error Message.");
          }

          $('#failed-modal').modal('show');
        }
      });
    }

    /**
     * Create Subcategory Part 1 of 3
     */
    function display_create_option_value_modal(element){
      $('#new-option-value-input-label').text("Enter New Option Value for Option \""+$(element).data('option-name')+"\"");

      $('#new-option-value-input').removeData('option-value-table-id');
      $('#new-option-value-input').removeData('option-id');
      $('#new-option-value-input').removeData('option-name');

      $('#new-option-value-input').attr('data-option-value-table-id', $(element).data("option-value-table-id"));
      $('#new-option-value-input').attr('data-option-id', $(element).data("option-id"));
      $('#new-option-value-input').attr('data-option-name', $(element).data("option-name"));

      $('#create-new-option-value-modal').modal('show');
    }

    /**
     * Create Subcategory Part 2 of 3
     */
    function display_new_option_value_details(element){
      $('#display-new-option-value').text($('#new-option-value-input').val());
      $('#display-for-option-name').text($('#new-option-value-input').data("option-name"));

      $('#confirm-new-option-value-modal').modal('show');
    }

    var optionValueSecondaryCounter = 0;

    /**
     * Create Subcategory Part 3 of 3
     */
    function save_new_option_value() {
      const data = {
        'value': $('#new-option-value-input').val().trim()
      };

      console.log("POST Option Value Data:");
      console.log(data);

      $.ajax({
        type: "POST",
        url: '/api/secured/options/'.concat($('#new-option-value-input').data('option-id')).concat("/values"),
        contentType: "application/json",
        data: JSON.stringify(data), // serializes the form's elements.
        beforeSend: function(xhr) {
          // xhr.setRequestHeader(
          //         $('meta[name=_csrf_header]').attr('content'),
          //         $('meta[name=_csrf]').attr('content')
          // )
          $('#create-new-option-value-modal').modal('hide');
          $('#confirm-new-option-value-modal').modal('hide');

          $('#wait-modal-title').text("Saving Option Value...");
          $('#wait-modal').modal('show');
        },
        success: function(data)
        {
          console.log(data);
          $('#wait-modal').modal('hide');

          optionValueSecondaryCounter--;

          let optionValueRow = `
                 <tr id="option-value-row-${data.valueId}">
                     <td id="option-value-text-${data.valueId}">
                        ${data.value}
                     </td>
                     <td style="padding: 5px;">
                            <button class="btn btn-outline-primary button-edit"
                                    type="button" style="font-size: 15px;"
                                    data-option-id="${data.optionId}"
                                    data-option-value-id="${data.valueId}"
                                    onclick="display_edit_option_value_modal(this)">
                              <i class="far fa-edit"></i>
                            </button>
                     </td>
                     <td style="padding: 5px;">
                          <button class="btn btn-outline-primary button-edit"
                                  type="button" style="font-size: 15px;"
                                  data-id="${data.optionId}-${data.valueId}"
                                  data-type-of-delete="option_value"
                                  data-name="${data.value}"
                                  onclick="display_delete_modal(this)">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                              <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                              <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                            </svg>
                          </button>
                     </td>
                 </tr>
          `;

          let optionValueTableId = $('#new-option-value-input').data("option-value-table-id");
          if($($('#option-values-table-'+optionValueTableId).children()[0]).data('has-none') === true){
            $("#option-values-table-"+optionValueTableId).html(optionValueRow);
          }
          else {
            $("#option-values-table-"+optionValueTableId).append(optionValueRow);
          }

          $('#success-modal-message').text("Successfully created new Option Value - \"" + data['value'] + "\"");
          $('#success-modal').modal('show');


          //fill_current_categories();
        },
        error: function(xhr) {
          console.log(xhr);
          testing = xhr;
          $('#wait-modal').modal('hide');

          $('#failed-modal-message-header').text("Creation Failed");
          var responseMessagesString = '';
          let responseMessages = xhr.responseJSON['messages'];

          if (responseMessages !== undefined) {
            for (let i = 0; i < responseMessages.length; i++) {
              responseMessagesString += ((i + 1) + ". " + responseMessages[i]['message'] + "\n");
            }
            $('#failed-modal-message').text("Error Message: \n" + responseMessagesString);
          } else {
            $('#failed-modal-message').text("Error Message: \nNo available Error Message.");
          }

          $('#failed-modal').modal('show');
        }
      });
    }

    /**
     * Edit Subcategory Part 1 of 3
     */
    function display_edit_option_value_modal(element){
      $.ajax({
        type: "GET",
        url: '/api/secured/options/'.concat($(element).data("option-id")).concat("/values/").concat($(element).data("option-value-id")),
        success: function(data)
        {
          $('#display-current-option-value').text(data['value']);

          $('#edit-option-value-input').removeData('option-value-id');
          $('#edit-option-value-input').attr('data-option-value-id', $(element).data("option-value-id"));

          $('#edit-option-value-input').removeData('option-id');
          $('#edit-option-value-input').attr('data-option-id', $(element).data("option-id"));

          $('#edit-option-value-modal').modal('show');
        },
        error: function(xhr) {
          console.log(xhr);
          testing = xhr;
          $('#wait-modal').modal('hide');

          $('#failed-modal-message-header').text("Data Retrieval Failed");
          var responseMessagesString = '';
          let responseMessages = xhr.responseJSON['messages'];

          if (responseMessages !== undefined) {
            for (let i = 0; i < responseMessages.length; i++) {
              responseMessagesString += ((i + 1) + ". " + responseMessages[i]['message'] + "\n");
            }
            $('#failed-modal-message').text("Error Message: \n" + responseMessagesString);
          } else {
            $('#failed-modal-message').text("Error Message: \nNo available Error Message.");
          }

          $('#failed-modal').modal('show');
        }
      });
    }

    /**
     * Edit Parent Category Part 2 of 3
     */
    function display_edit_option_value_details(){
      $.ajax({
        type: "GET",
        url: '/api/secured/options/'.
        concat($('#edit-option-value-input').data("option-id")).
        concat("/values/").
        concat($('#edit-option-value-input').data("option-value-id")),
        success: function(data)
        {
          $('#display-currently-stored-option-value').text(data['value']);
          $('#display-new-edit-option-value').text($('#edit-option-value-input').val());

          $('#confirm-edit-option-value-modal').modal('show');
        },
        error: function(xhr) {
          console.log(xhr);
          testing = xhr;
          $('#wait-modal').modal('hide');

          $('#failed-modal-message-header').text("Data Retrieval Failed");
          var responseMessagesString = '';
          let responseMessages = xhr.responseJSON['messages'];

          if (responseMessages !== undefined) {
            for (let i = 0; i < responseMessages.length; i++) {
              responseMessagesString += ((i + 1) + ". " + responseMessages[i]['message'] + "\n");
            }
            $('#failed-modal-message').text("Error Message: \n" + responseMessagesString);
          } else {
            $('#failed-modal-message').text("Error Message: \nNo available Error Message.");
          }

          $('#failed-modal').modal('show');
        }
      });
    }

    /**
     * Edit Parent Category Part 3 of 3
     */
    function save_edit_option_value(){
      const data = {
        'value': $('#edit-option-value-input').val().trim()
      };

      $.ajax({
        type: "PATCH",
        url: '/api/secured/options/'.
        concat($('#edit-option-value-input').data("option-id")).
        concat("/values/").
        concat($('#edit-option-value-input').data("option-value-id")),
        contentType: "application/json",
        data: JSON.stringify(data), // serializes the form's elements.
        beforeSend: function(xhr) {
          // xhr.setRequestHeader(
          //         $('meta[name=_csrf_header]').attr('content'),
          //         $('meta[name=_csrf]').attr('content')
          // )
          $('#edit-option-value-modal').modal('hide');
          $('#confirm-edit-option-value-modal').modal('hide');

          $('#wait-modal-title').text("Saving Option Value...");
          $('#wait-modal').modal('show');
        },
        success: function(data)
        {
          console.log(data);
          $('#wait-modal').modal('hide');

          let oldValue = $('#option-value-text-'+data['valueId']).text();
          $('#option-value-text-'+data['valueId']).text(data['value']);
          $($('#option-value-text-'+data['valueId']).next().next().children()[0]).removeData('name');
          $($('#option-value-text-'+data['valueId']).next().next().children()[0]).attr('data-name', data['value']);



          $('#success-modal-message').text("Successfully edited Option Value - \"" + oldValue + "\" to - \"" + data['value'] + "\"");
          $('#success-modal').modal('show');


          //fill_current_categories();
        },
        error: function(xhr) {
          console.log(xhr);
          testing = xhr;
          $('#wait-modal').modal('hide');

          $('#failed-modal-message-header').text("Edit Failed");
          var responseMessagesString = '';
          let responseMessages = xhr.responseJSON['messages'];

          if (responseMessages !== undefined) {
            for (let i = 0; i < responseMessages.length; i++) {
              responseMessagesString += ((i + 1) + ". " + responseMessages[i]['message'] + "\n");
            }
            $('#failed-modal-message').text("Error Message: \n" + responseMessagesString);
          } else {
            $('#failed-modal-message').text("Error Message: \nNo available Error Message.");
          }

          $('#failed-modal').modal('show');
        }
      });

    }

    function delete_option_value(element){
      let combinedId = $(element).data('id');
      let splitId = combinedId.split("-");
      let optionId = splitId[0];
      let optionValueId = splitId[1];
      $.ajax({
        type: "DELETE",
        url: '/api/secured/options/'.
        concat(optionId).
        concat("/values/").
        concat(optionValueId),
        beforeSend: function(xhr) {
          // xhr.setRequestHeader(
          //         $('meta[name=_csrf_header]').attr('content'),
          //         $('meta[name=_csrf]').attr('content')
          // )
          $('#confirm-delete-modal').modal('hide');

          $('#wait-modal-title').text("Deleting Option Value...");
          $('#wait-modal').modal('show');
        },
        success: function(data)
        {
          $('#wait-modal').modal('hide');

          let dataId = $(element).removeData('id');
          $('[data-id='+dataId+']').parent().parent().remove();

          // if(!($('#categoryAccordionPanels').children().length > 0)){
          //   let noSubcategoriesDiv = `
          //     <tr data-has-none="true">
          //        <td>No Subcategories</td>
          //      </tr>
          //   `;
          //   $('#categoryAccordionPanels').append(noSubcategoriesDiv);
          // }

          $('#success-modal-message').text("Successfully deleted Option Value");
          $('#success-modal').modal('show');


          //fill_current_categories();
        },
        error: function(xhr) {
          $('#wait-modal').modal('hide');

          $('#failed-modal-message-header').text("Delete Failed");
          var responseMessagesString = '';
          let responseMessages = xhr.responseJSON['messages'];
          console.log(xhr);
          testing = xhr;
          if (responseMessages !== undefined) {
            for (let i = 0; i < responseMessages.length; i++) {
              responseMessagesString += ((i + 1) + ". " + responseMessages[i]['message'] + "\n");
            }
            $('#failed-modal-message').text("Error Message: \n" + responseMessagesString);
          } else {
            $('#failed-modal-message').text("Error Message: \nNo available Error Message.");
          }

          $('#failed-modal').modal('show');
        }
      });
    }

    /*
    Expand all accordions by default
    */
    $('#edit-options-modal-button').on('click', function() {
      $('.accordion-button').removeClass('collpased');
      $('.accordion-collapse').collapse('show');
    });


    $("#add-new-option-button").click(function(){
      var lastId = $(".product-option:last").attr("id");
      var splitId = lastId.split("-");
      var nextIndex = parseInt(splitId[2]) + 1;

      const newDiv = `
        <div class="product-option" id="product-option-${nextIndex}">
            <h5>Option ${nextIndex}</h5>
            <label for="option-name-${nextIndex}" class="form-check-label">Option Name</label>
            <select class="form-select option-select" id="option-name-${nextIndex}" name="option-name-${nextIndex}"
                    onchange="fillOptionValueSelects(this)">
            </select>
            <small id="if-duplicate-option-${nextIndex}" style="color: #dc3545; display: none;">Cannot have duplicated Options or Values!</small>
            <p class="text-center" id="if-no-option-values-${nextIndex}" style="display: none; color: red;">
              There are no Option Values in the database for this Option. Please make one
              using the "Edit Options" button.
            </p>

            <div id="option-values-container-${nextIndex}" class="option-values-container container">
                <div class="row justify-content-center">
                  <div class="col-lg-8 col-md-12 align-items-start">
                    <label for="product-option-value-nextIndex-1" class="form-check-label">Value Name</label>
                    <select class="product-option-values-${nextIndex} product-option-value form-select" id="product-option-value-${nextIndex}-1">
                    </select>
                  </div>
                  <div class="col p-3">

                  </div>
                </div>
            </div>
            <br>
            <button class="btn btn-primary" id="add-option-value-${nextIndex}" onclick="add_option_value(${nextIndex})">
             + Add Option Value
            </button>
            <button class="delete-product-option btn btn-danger" id="delete-product-option-${nextIndex}" onclick="delete_option_input(${nextIndex})">
                Remove Option
            </button>
        </div>`;

      $(".product-option:last").after(newDiv);
      let currentOptions = $('#option-name-1').html();
      let currentOptionValues = $('#product-option-value-1-1').html();
      $('#option-name-'+nextIndex).html(currentOptions);
      $('#product-option-value-'+nextIndex+'-1').html(currentOptionValues);
      if($('#if-no-option-values-1').is(":visible")){
        $('#if-no-option-values-'+nextIndex).toggle();
      }
    });

    function delete_option_input(id){
      var deleteIndex = id;

      console.log(deleteIndex);
      $("#product-option-" + deleteIndex).remove();
    }

    function add_option_value(parentId){
      var lastId = $('.product-option-values-'+parentId+':last').attr("id");
      var splitId = lastId.split("-");
      var nextIndex = parseInt(splitId[4]) + 1;
      let newOptionValue=`
                <div class="row justify-content-center">
                  <div class="col-lg-8 col-md-12 align-items-start">
                    <label for="product-option-value-${parentId}-${nextIndex}" id="product-option-value-${parentId}-${nextIndex}-label"
                           class="form-check-label">Value Name</label>
                    <select class="product-option-values-${parentId} product-option-value form-select" id="product-option-value-${parentId}-${nextIndex}">
                    </select>
                  </div>
                  <div class="col p-3">
                    <button class="delete-option-value btn btn-danger" id="delete-product-option-value-${parentId}-${nextIndex}"
                            onclick="delete_option_value_input(${parentId}, ${nextIndex}, this)">
                        Remove Value
                    </button>
                  </div>
                </div>
        `;
      $('#option-values-container-'+parentId).append(newOptionValue);
      let currentOptionValues = $('#product-option-value-'+parentId+'-1').html();
      $('#product-option-value-'+parentId+"-"+nextIndex).html(currentOptionValues);
    }

    function delete_option_value_input(parentId, optionValueId, deleteButton){
      $(deleteButton).parent().parent().remove();
      // $("#product-option-value-" + parentId + "-" + optionValueId).remove();
      // $(deleteButton).remove();
      // $("#product-option-value-" + parentId + "-" + optionValueId+"-label").remove();
    }

    $('#has-options').change(
            function(){
              $('#options-container').toggle();
              if(this.checked){
                $('#no-variant-submit-container').css('display', 'none');
                $('#no-variant-submit').css('display', 'none');
                $('#solo-low-stock-limit-label').css('display', 'none');
                $('#solo-product-low-stock-limit').css('display', 'none');
                $('#solo-low-stock-limit-container').css('display', 'none');
                // $('#variants-card').css('display', 'none');
                $('#generate-variants-button').css('display', '');
              }
              else{
                $('#no-variant-submit-container').css('display', '');
                $('#no-variant-submit').css('display', '');
                $('#solo-low-stock-limit-label').css('display', '');
                $('#solo-product-low-stock-limit').css('display', '');
                $('#solo-low-stock-limit-container').css('display', '');
                // $('#variants-card').css('display', '');
                $('#generate-variants-button').css('display', 'none');
              }
            }
    );

    function fillOptionValueSelects(selectElement){
      var idValue = parseInt($(selectElement).attr('id').split("-")[2]);
      $.ajax({
        type: "GET",
        url: '/api/secured/options/'.concat($(selectElement).val()).concat("/values"),
        success: function(data)
        {
          if(jQuery.isEmptyObject(data['values'])){
            $('#if-no-option-values-'+idValue).css("display", "");
            $('.product-option-values-'+idValue).each(function(index, element) {
                      $(this).empty();
                    }
            );
          }
          else{
            $('#if-no-option-values-'+idValue).css("display", "none");
            $('.product-option-values-'+idValue).each(function(index, element){
              $(this).empty();
              for(let i = 0; i < data['values'].length; i++){
                if(i === 0){
                  $(this).append($('<option>', {
                    selected: true,
                    value: data['values'][i]['valueId'],
                    text : data['values'][i]['value']
                  }));
                }
                else{
                  $(this).append($('<option>', {
                    value: data['values'][i]['valueId'],
                    text : data['values'][i]['value']
                  }));
                }
              }
            });
          }
        },
        error: function(xhr) {
          console.log(xhr);
          testing = xhr;

          $('#failed-modal-message-header').text("Data Retrieval Failed");
          var responseMessagesString = '';
          let responseMessages = xhr.responseJSON['messages'];

          if (responseMessages !== undefined) {
            for (let i = 0; i < responseMessages.length; i++) {
              responseMessagesString += ((i + 1) + ". " + responseMessages[i]['message'] + "\n");
            }
            $('#failed-modal-message').text("Error Message: \n" + responseMessagesString);
          } else {
            $('#failed-modal-message').text("Error Message: \nNo available Error Message.");
          }

          $('#failed-modal').modal('show');
        }
      });
    }

    function fill_options_on_page_load(){
      let optionId = $('#option-name-1').val();
      if(optionId !== null){
        $.ajax({
          type: "GET",
          url: '/api/secured/options/'.concat(optionId).concat("/values"),
          success: function(data)
          {
            if(jQuery.isEmptyObject(data['values'])){
              $('#if-no-option-values-1').css("display", "");
              $('#product-option-value-1-1').empty();
            }
            else{
              $('#if-no-option-values-1').css("display", "none");
              for(let i = 0; i < data['values'].length; i++){
                if(i === 0){
                  $('#product-option-value-1-1').append($('<option>', {
                    selected: true,
                    value: data['values'][i]['valueId'],
                    text : data['values'][i]['value']
                  }));
                }
                else{
                  $('#product-option-value-1-1').append($('<option>', {
                    value: data['values'][i]['valueId'],
                    text : data['values'][i]['value']
                  }));
                }
              }
            }
          },
          error: function(xhr) {
            console.log(xhr);
            testing = xhr;

            $('#failed-modal-message-header').text("Data Retrieval Failed");
            var responseMessagesString = '';
            let responseMessages = xhr.responseJSON['messages'];

            if (responseMessages !== undefined) {
              for (let i = 0; i < responseMessages.length; i++) {
                responseMessagesString += ((i + 1) + ". " + responseMessages[i]['message'] + "\n");
              }
              $('#failed-modal-message').text("Error Message: \n" + responseMessagesString);
            } else {
              $('#failed-modal-message').text("Error Message: \nNo available Error Message.");
            }

            $('#failed-modal').modal('show');
          }
        });
      }
    }

    function updateOptionSelects(){

    }

    //End Options
    //-----------------------------------------------------------------------------------------------------------------------
    //Start Products

    function display_new_product_details(typeOfSubmit){
        $('#display-new-name').text($('#name').val());
        $('#display-new-brand').text($('#brand').val());
        $('#display-new-price').text("$" + $('#price').val());
        // if ($('#is-published').is(":checked")){
        //     $('#display-new-is-published').text("Yes");
        // }
        // else{
        //     $('#display-new-is-published').text("No");
        // }
        if ($('#is-big-item').is(":checked")){
            $('#display-new-is-big-item').text("Yes");
        }
        else{
            $('#display-new-is-big-item').text("No");
        }
        if ($('#is-waitlistable').is(":checked")){
            $('#display-new-is-waitlisted').text("Yes");
        }
        else{
            $('#display-new-is-waitlisted').text("No");
        }
        $('#display-new-description').text($('#description').val());
        $('#display-new-category').text($('#categories option:selected').text());

        let modalFooter = `
        <button class="btn btn-outline-default" data-bs-dismiss="modal">Return</button>
        <button id="save-new-product-button-${typeOfSubmit}"
                  class="btn btn-success"
                  onclick="submit_all(${typeOfSubmit})">Save</button>
        `;
        $('#confirm-create-product-modal-footer').empty();
        $('#confirm-create-product-modal-footer').html(modalFooter);
        $('#confirm-create-product-modal').modal('show');
    }

    function set_all_low_stock_input(){
      $('.lowStockLimitInput').each(function (){
        $(this).val($('#changeAllLowStockLimitInput').val());
      });
    }

    function delete_variant(rowNumber){
      if(deleteTracker.includes(rowNumber)){
        const index = deleteTracker.indexOf(rowNumber);
        if (index > -1){
          deleteTracker.splice(index, 1);
        }
        $("#deleteVariant"+(rowNumber)).html("Disable");
        $("#product-create"+rowNumber).css("background-color", "transparent");
      }
      else{
        deleteTracker.push(rowNumber);
        $("#deleteVariant"+(rowNumber)).html("Restore");
        $("#product-create"+rowNumber).css("background-color", "#f78686");
      }
      console.log(deleteTracker);
    }

    var deleteTracker;
    function finish_products_table(valueCombinations, idCombinations){
      $('#finishProductsFormBody').html("");
      for(let i = 0; i < valueCombinations.length; i++){
        $('#finishProductsFormBody').append("<tr id='product-create"+(i+1)+"' data-value-ids='"+idCombinations[i]+"'>" +
                "            <td>"+valueCombinations[i].toString().replaceAll(" ", "/")+"</td>\n" +
                // "            <td><select id='product-image-select"+(i+1)+"' class='product-image-select'></select></td>\n" +
                // "            <td><input type=\"checkbox\" id='product-is-in-use-input'"+(i+1)+"' checked></td>" +
                "            <td><input id='product-low-stock-limit-input"+(i+1)+"' class=\"lowStockLimitInput form-control\" type=\"number\" min=\"0\" value=\"0\"></td>" +
                "            <td><button type=\"button\" class=\"btn btn-danger rounded-pill text-decoration-none\" id='deleteVariant"+(i+1)+"' onclick='delete_variant("+(i+1)+")'>Disable</button></td>" +
                "           </tr>");
      }

      $('#finishProductsForm').removeData('count');
      $('#finishProductsForm').attr('data-count', valueCombinations.length);
      // $('.product-image-select').each(function (i, obj) {
      //   for(let i = 0; i < imageUrls.length; i++){
      //     $(this).append($('<option>', {
      //       value: imageUrls[i],
      //       text : imageUrls[i]
      //     }));
      //   }
      // });
      deleteTracker = [];
      //$('#create-part-one').css("display", "none");
    }


    function check_options_are_unique(){
      $('#variants-card').css('display', 'none');

      let optionIds = [];
      $('.option-select').each(function(index, element){
        optionIds.push(parseInt($(this).val()));

        $(this).css('border-color', '#28a745');
        $(this).next().css('display', 'none');
      });

      let numberOfOptions = $('.product-option').length;

      let optionValueIds = [];
      let optionDomNumbers = [];
      $('.product-option').each(function(index, element){
        let optionDomNumber = parseInt($(this).attr('id').split("-")[2]);
        optionDomNumbers.push(optionDomNumber);
      });
      console.assert(optionDomNumbers.length == numberOfOptions);
      for(let i = 0; i < numberOfOptions; i++){
        $('.product-option-values-'+optionDomNumbers[i]).each(function(index, element){
          $(this).css('border-color', '#28a745');
          $(this).parent().parent().parent().prev().prev().css('display', 'none');
          optionValueIds.push(parseInt($(this).val()));
        });
      }

      console.log("Option Ids");
      console.log(optionIds);
      console.log("Option Value Ids");
      console.log(optionValueIds);


      let duplicatedOptionIds = optionIds.filter((element, index, array) => array.indexOf(element) !== index);
      console.log("Duplicated Option Ids");
      console.log(duplicatedOptionIds);
      if(duplicatedOptionIds.length !== 0){
        let duplicatedOptions = [];
        $('.option-select').each(function(index, element){
          if(duplicatedOptionIds.includes(parseInt($(this).val()))){
            duplicatedOptions.push($(this).attr('id'));
            $(this).css('border-color', '#dc3545');
            $(this).next().text('Cannot have duplicated Options!');
            $(this).next().css('display', '');
          }
        });
        $('html, body').animate({ scrollTop: $('#'+duplicatedOptions[0]).offset().top}, 'fast');
      }

      let duplicatedOptionValueIds = optionValueIds.filter((element, index, array) => array.indexOf(element) !== index);
      console.log("Duplicated Option Value Ids");
      console.log(duplicatedOptionValueIds);
      if(duplicatedOptionValueIds.length !== 0){
        let duplicatedOptionValues = [];
        $('.product-option-value').each(function(index, element){
          if(duplicatedOptionValueIds.includes(parseInt($(this).val()))){
            duplicatedOptionValues.push($(this).attr('id'));
            $(this).css('border-color', '#dc3545');
            $(this).parent().parent().parent().prev().prev().text('Cannot have duplicated or invalid Values!');
            $(this).parent().parent().parent().prev().prev().css('display', '');
          }
        });
        if(duplicatedOptionIds.length === 0){
          $('html, body').animate({ scrollTop: $('#'+duplicatedOptionValues[0]).offset().top}, 'fast');
        }
      }

      if(duplicatedOptionIds.length === 0 && duplicatedOptionValueIds.length === 0){
        create_all_possible_variants();
      }
    }

    var valueCombinations;
    var idCombinations;

    var allOptionValues;
    var allOptionValueIds;
    function create_all_possible_variants(){
      // $('#variants-card').css("display", "");
      // let numberOfOptions = $('.product-option').length;
      // let totalNumAttributesOnPage = parseInt($('#attributesTable tr:last').data("index"))+1;
      // //let allAttributes = new Array(totalNumAttributesOnPage);
      // //console.log(totalNumAttributesOnPage);
      // allAttributeValues = new Array(totalNumAttributesOnPage);
      // allAttributeIDS = new Array(totalNumAttributesOnPage);
      // for(let i = 0; i < allAttributeValues.length; i++){
      //   allAttributeValues[i] = [];
      //   allAttributeIDS[i] = [];
      // }
      // for(let i = 0; i < allAttributeValues.length; i++){
      //   let selectionString = 'selection'+i;
      //   $("input[name="+selectionString+"]:checked").each(function(index, input){
      //     allAttributeValues[i].push(input.dataset.attrvalue);
      //     allAttributeIDS[i].push(input.dataset.attrid);
      //   });
      // }
      // let allAttributeValuesFiltered = allAttributeValues.filter(function(el){
      //   return el.length > 0;
      // });
      // let allAttributeIDSFiltered = allAttributeIDS.filter(function(el){
      //   return el.length > 0;
      // });
      // allAttributeValues = allAttributeValuesFiltered;
      // allAttributeIDS = allAttributeIDSFiltered;
      //
      // valueCombinations = generate_all_attribute_combinations(allAttributeValues);
      // idCombinations = generate_all_attribute_combinations(allAttributeIDS);
      //
      // finish_products_table(valueCombinations, idCombinations);

      $('#variants-card').css("display", "");
      let numberOfOptions = $('.product-option').length;

      allOptionValues = new Array(numberOfOptions);
      allOptionValueIds = new Array(numberOfOptions);
      for(let i = 0; i < numberOfOptions; i++){
        allOptionValues[i] = [];
        allOptionValueIds[i] = [];
      }
      let optionDomNumbers = [];
      $('.product-option').each(function(index, element){
        let optionDomNumber = parseInt($(this).attr('id').split("-")[2]);
        optionDomNumbers.push(optionDomNumber);
      });
      console.assert(optionDomNumbers.length == numberOfOptions);
      for(let i = 0; i < numberOfOptions; i++){
        $('.product-option-values-'+optionDomNumbers[i]).each(function(index, element){
          allOptionValues[i].push($(this).find('option:selected').text());
          allOptionValueIds[i].push(parseInt($(this).val()));
        });
      }
      console.log(allOptionValues);
      console.log(allOptionValueIds);
      let allOptionValuesFiltered = allOptionValues.filter(function(el){
        return el.length > 0;
      });
      let allOptionValueIDSFiltered = allOptionValueIds.filter(function(el){
        return el.length > 0;
      });
      allOptionValues = allOptionValuesFiltered;
      allOptionValueIds = allOptionValueIDSFiltered;

      valueCombinations = generate_all_attribute_combinations(allOptionValues);
      idCombinations = generate_all_attribute_combinations(allOptionValueIds);

      finish_products_table(valueCombinations, idCombinations);
    }


    function generate_all_attribute_combinations(allAttributeArrays){

      // First, handle some degenerate cases...
      if(!allAttributeArrays){
        // Or maybe we should toss an exception...?
        return [];
      }

      if(!Array.isArray(allAttributeArrays)){
        // Or maybe we should toss an exception...?
        return [];
      }

      if(allAttributeArrays.length == 0){
        return [];
      }

      for(let i=0; i < allAttributeArrays.length; i++){
        if(!Array.isArray(allAttributeArrays[i]) || allAttributeArrays[i].length == 0){
          // If any of the arrays in allAttributeArrays are not arrays or zero-length, return an empty array...
          return [];
        }
      }
      // Done with degenerate cases...

      // Start "odometer" with a 0 for each array in array_of_arrays.
      let odometer = new Array(allAttributeArrays.length);
      odometer.fill(0);

      let output = [];

      let newCombination = formCombination(odometer, allAttributeArrays);

      output.push(newCombination);

      while(odometer_increment(odometer, allAttributeArrays)){
        newCombination = formCombination(odometer, allAttributeArrays);
        output.push(newCombination);
      }

      return output;
    }/* combineArrays() */


    // Translate "odometer" to combinations from allAttributeArrays
    function formCombination(odometer, allAttributeArrays){
      //In Imperative Programmingese (i.e., English):
      let s_output = "";
      for(let i=0; i < odometer.length; i++){
        s_output += " " + allAttributeArrays[i][odometer[i]];
      }
      let trim_output = s_output.trim();
      //console.log(trim_output);
      return trim_output;

      // // In Functional Programmingese (Henny Youngman one-liner):
      // return odometer.reduce(
      //     function(accumulator, odometer_value, odometer_index){
      //         return "" + accumulator + array_of_arrays[odometer_index][odometer_value];
      //     },
      //     ""
      // );
    }/* formCombination() */

    function odometer_increment(odometer, allAttributeArrays){

      // Basically, work you way from the rightmost digit of the "odometer"...
      // if you're able to increment without cycling that digit back to zero,
      // you're all done, otherwise, cycle that digit to zero and go one digit to the
      // left, and begin again until you're able to increment a digit
      // without cycling it...simple, huh...?

      for(let i_odometer_digit=odometer.length-1; i_odometer_digit>=0; i_odometer_digit--){

        let maxee = allAttributeArrays[i_odometer_digit].length - 1;

        if(odometer[i_odometer_digit] + 1 <= maxee){
          // increment, and you're done...
          odometer[i_odometer_digit]++;
          return true;
        }
        else{
          if(i_odometer_digit - 1 < 0){
            // No more digits left to increment, end of the line...
            return false;
          }
          else{
            // Can't increment this digit, cycle it to zero and continue
            // the loop to go over to the next digit...
            odometer[i_odometer_digit]=0;
            continue;
          }
        }
      }/* for( let odometer_digit = odometer.length-1; odometer_digit >=0; odometer_digit-- ) */

    }/* odometer_increment() */

    const showError = (input, message) => {
      const formField = input.parent();

      formField.find('input').css('border-color', '#dc3545');
      formField.find('textarea').css('border-color', '#dc3545');

      const error = formField.find('small');
      error.text(message);
    };

    const showSuccess = (input) => {
      const formField = input.parent();

      formField.find('input').css('border-color', '#28a745');
      formField.find('textarea').css('border-color', '#28a745');

      const error = formField.find('small');
      error.text('');
    };

    const isRequired = (value) => {return value !== '';};

    const checkName = () => {
      let valid = false;
      const name = $('#name');
      if(!isRequired(name.val().trim())){
        showError(name, 'Name cannot be blank.');
      }
      else {
        showSuccess(name);
        valid = true;
      }
      return valid;
    };

    const checkBrand = () => {
      let valid = false;
      const brand = $('#brand');
      if(!isRequired(brand.val().trim())){
        showError(brand, 'Brand cannot be blank.');
      }
      else {
        showSuccess(brand);
        valid = true;
      }
      return valid;
    };

    const countDecimals = (value) => {
      if(Math.floor(value) != value){
        return value.toString().split(".")[1].length || 0;
      }
      return 0;
    };

    const checkPrice = () => {
      let valid = false;
      const price = $("#price");
      if(countDecimals(price.val()) > 2){
        showError(price, 'A price may not have more than 2 decimal places.');
      }
      else if(price.val().length === 0){
        showError(price, 'Price cannot be blank.');
      }
      else if(parseFloat(price.val()) < 0.00){
        showError(price, 'Price cannot be negative.');
      }
      else if(parseFloat(price.val()) === 0.00){
        showError(price, 'Price cannot be zero.');
      }
      else {
        showSuccess(price);
        valid = true;
      }
      return valid;
    };

    const checkDescription = () => {
      let valid = false;
      const description = $('#description');
      if(!isRequired(description.val().trim())){
        showError(description, 'Description cannot be blank.');
      }
      else {
        showSuccess(description);
        valid = true;
      }
      return valid;
    };

    $('#create-product-info-form').on('input', function(e){
      switch(e.target.id) {
        case 'name':
          checkName();
          break;
        case 'brand':
          checkBrand();
          break;
        case 'price':
          checkPrice();
          break;
        case 'description':
          checkDescription();
          break;
      }
    });



    function submit_all(typeOfSubmit){

      let isFormValid = checkName() && checkPrice() && checkBrand() && checkDescription();
      if(!isFormValid){
        $('#confirm-create-product-modal').modal('hide');
        $('html, body').animate({ scrollTop: 0 }, 'fast');
        return;
      }
      const url = '/api/secured/products';

      let optionIds = [];
      //typeOfSubmit = 0 - no Options + Variants
      //typeOfSubmit = 1 - has Options + Variants
      if(typeOfSubmit === 1){
        $('.option-select').each(function(index, element){
          optionIds.push(parseInt($(this).val()));
        });
      }

      const data = {
        'name': $('#name').val(),
        'brand': $('#brand').val(),
        'price': parseFloat($("#price").val()).toFixed(2),
        // 'isPublished': $('#is-published').is(':checked'),
        'isPublished': false,
        'isBigItem': $('#is-big-item').is(':checked'),
        'isWaitListEnabled': $('#is-waitlistable').is(':checked'),
        'description': $('#description').val(),
        'categoryId': $('#categories option:selected').val(),
        'optionIds': optionIds
      };
      console.log("Product Info Data:\n");
      console.log(data);

      $.ajax({
        type: "POST",
        url: url,
        contentType: "application/json",
        data: JSON.stringify(data), // serializes the form's elements.
        beforeSend: function(xhr) {
          // xhr.setRequestHeader(
          //         $('meta[name=_csrf_header]').attr('content'),
          //         $('meta[name=_csrf]').attr('content')
          // );
          $('#confirm-create-product-modal').modal('hide');

          $('#wait-modal-title').text("Saving Product...");
          $('#wait-modal').modal('show');
        },
        success: function(data)
        {
          //$('#confirm-product-group-create-modal').modal('hide');
          //$('#create-product-group-success-modal').modal('show');
          submit_product_forms(data['id'], typeOfSubmit);
        },
        error: function(xhr) {
          console.log(xhr);
          testing = xhr;
          $('#wait-modal').modal('hide');

          $('#failed-modal-message-header').text("Product Info Creation Failed");
          var responseMessagesString = '';
          let responseMessages = xhr.responseJSON['messages'];

          if (responseMessages !== undefined) {
            for (let i = 0; i < responseMessages.length; i++) {
              responseMessagesString += ((i + 1) + ". " + responseMessages[i]['message'] + "\n");
            }
            $('#failed-modal-message').text("Error Message: \n" + responseMessagesString);
          } else {
            $('#failed-modal-message').text("Error Message: \nNo available Error Message.");
          }

          $('#failed-modal').modal('show');
        }
      });
    }

    function submit_product_forms(productId, typeOfSubmit){
      if(typeOfSubmit === 1){
        let variants = [];
        let numVariants = parseInt($('#finishProductsForm').data("count"));
        for(let j = 0; j < numVariants; j++){
          if(deleteTracker.includes(j+1)){
            continue;
          }
          let optionValues = [];
          let arrayOfValueIds = $("#product-create"+(j+1)).data("value-ids").toString().split(" ").map(i=>Number(i));
          for(let k = 0; k < arrayOfValueIds.length; k++){
            optionValues.push(arrayOfValueIds[k]);
          }
          const variant = {
            // 'imagePath': $('#product-image-select'+(j+1)).val(),
            'isInUse': true,
            'waitListThreshold': parseInt($("#product-low-stock-limit-input"+(j+1)).val()),
            'optionValueIds': optionValues
          };
          console.log(variant);
          $.ajax({
            type: "POST",
            url: '/api/secured/products/'.concat(productId).concat('/variants'),
            contentType: "application/json",
            data: JSON.stringify(variant), // serializes the form's elements.
            beforeSend: function(xhr) {
              // xhr.setRequestHeader(
              //         $('meta[name=_csrf_header]').attr('content'),
              //         $('meta[name=_csrf]').attr('content')
              // )
            },
            success: function()
            {
              if(j === numVariants-1){
                post_product_creation_success(productId);
              }
              // $('#success-redirect').attr("href", "/management/product/update?id="+pgid)
            },
            error: function(xhr) {
              console.log(xhr);
              testing = xhr;
              $('#wait-modal').modal('hide');

              $('#failed-modal-message-header').text("Product Variant Creation Failed");
              var responseMessagesString = '';
              let responseMessages = xhr.responseJSON['messages'];

              if (responseMessages !== undefined) {
                for (let i = 0; i < responseMessages.length; i++) {
                  responseMessagesString += ((i + 1) + ". " + responseMessages[i]['message'] + "\n");
                }
                $('#failed-modal-message').text("Error Message: \n" + responseMessagesString);
              } else {
                $('#failed-modal-message').text("Error Message: \nNo available Error Message.");
              }

              $('#failed-modal').modal('show');
              return;
            }
          });
        }
      }
      else {
        const variant = {
          // 'imagePath': $('#product-image-select'+(j+1)).val(),
          'isInUse': true,
          'waitListThreshold': parseInt($("#solo-product-low-stock-limit").val()),
          'optionValueIds': []
        };
        console.log(variant);
        $.ajax({
          type: "POST",
          url: '/api/secured/products/'.concat(productId).concat('/variants'),
          contentType: "application/json",
          data: JSON.stringify(variant), // serializes the form's elements.
          beforeSend: function (xhr) {
            // xhr.setRequestHeader(
            //         $('meta[name=_csrf_header]').attr('content'),
            //         $('meta[name=_csrf]').attr('content')
            // )
          },
          success: function () {
            // $('#success-redirect').attr("href", "/management/product/update?id="+pgid)
            post_product_creation_success(productId);
          },
          error: function (xhr) {
            console.log(xhr);
            testing = xhr;
            $('#wait-modal').modal('hide');

            $('#failed-modal-message-header').text("Solo Product Variant Creation Failed");
            var responseMessagesString = '';
            let responseMessages = xhr.responseJSON['messages'];

            if (responseMessages !== undefined) {
              for (let i = 0; i < responseMessages.length; i++) {
                responseMessagesString += ((i + 1) + ". " + responseMessages[i]['message'] + "\n");
              }
              $('#failed-modal-message').text("Error Message: \n" + responseMessagesString);
            } else {
              $('#failed-modal-message').text("Error Message: \nNo available Error Message.");
            }

            $('#failed-modal').modal('show');
          }
        });
      }
    }

    function post_product_creation_success(productId){
      $.ajax({
        type: "GET",
        url: '/api/secured/products/'.concat(productId).concat('/variants'),
        success: function(data)
        {
          testing = data;
          console.log(data);
          for(let i = 0; i < data.variants.length; i++){
            let optionsString = "";
            if(data.variants[i].options.length === 0){
              optionsString = "Solo Variant";
            }
            else{
              for(let j = 0; j < data.variants[i].options.length; j++){
                optionsString += data.variants[i].options[j].value + "/"
              }
            }

            let variantRow = `
              <tr id="variant-post-image-${i+1}" data-variant-id="${data.variants[i].id}">
                <td>
                  <button class="btn" onclick="choose_image(${i+1})"><i class="fa fa-plus"></i></button>
                </td>
                <td>
                    <img id="variant-post-image-display-${i+1}" style="max-width: 100%; max-height: 200px;">
                </td>
                <td>
                  ${optionsString}
                </td>
              </tr>
            `;

            $('#finish-variants-table-2').removeData('count');
            $('#finish-variants-table-2').attr('data-count', data.variants.length);
            $('#finish-variants-table-2').removeData('product-id');
            $('#finish-variants-table-2').attr('data-product-id', productId);
            $('#finish-variants-table-body-2').append(variantRow);
          }
        },
        error: function(xhr) {
          console.log(xhr);
          testing = xhr;
          $('#wait-modal').modal('hide');

          $('#failed-modal-message-header').text("Data Retrieval Failed");
          var responseMessagesString = '';
          let responseMessages = xhr.responseJSON['messages'];

          if (responseMessages !== undefined) {
            for (let i = 0; i < responseMessages.length; i++) {
              responseMessagesString += ((i + 1) + ". " + responseMessages[i]['message'] + "\n");
            }
            $('#failed-modal-message').text("Error Message: \n" + responseMessagesString);
          } else {
            $('#failed-modal-message').text("Error Message: \nNo available Error Message.");
          }

          $('#failed-modal').modal('show');
        }
      });

      $('#create-product-part-1-info').css('opacity', 0.5);
      $('#create-product-part-1-info').css('pointer-events', 'none');
      $('#return-to-products-button').css('display', 'none');
      $('#create-product-part-2-images').removeData("product-id");
      $('#create-product-part-2-images').attr("data-product-id", productId);
      $('#create-product-part-2-images').css('display', '');
      $('#wait-modal').modal('hide');

      $('#success-modal-message').text("Successfully created Product + Variants!");
      $('#success-modal').modal('show');
    }


    function choose_image(variantRowNumber){
      $('#images-modal').removeData("variant-row-number");
      $('#images-modal').attr("data-variant-row-number", variantRowNumber);
      $('#images-modal').modal('show');

    }

    function assign_image(src, id){
      let rowNumber = $('#images-modal').data('variant-row-number');
      $('#variant-post-image-'+rowNumber).removeData('image-src');
      $('#variant-post-image-'+rowNumber).attr("data-image-src", src);
      $('#variant-post-image-'+rowNumber).removeData('image-id');
      $('#variant-post-image-'+rowNumber).attr("data-image-id", id);
      $('#variant-post-image-display-'+rowNumber).attr("src", src);
      $('#images-modal').modal('hide');
    }

    var imageUrls = [];
    var numImagesUploaded = 1;
    $("#image-upload").change(function(e){
      //stop submit the form, we will post it manually.
      e.preventDefault();

      // Get form
      var form = $('#file-upload-form')[0];

      // Create an FormData object
      var data = new FormData(form);

      // If you want to add an extra field for the FormData
      // data.append("CustomField", "This is some extra data, testing");

      data.append("alt", "some alt text");
      data.append("position", numImagesUploaded);
      // disabled the submit button
      $("#file-upload-form").prop("disabled", true);

      $.ajax({
        type: "POST",
        enctype: 'multipart/form-data',
        url: '/api/secured/products/'.concat($('#create-product-part-2-images').data("product-id")).concat('/images'),
        data: data,
        processData: false,
        contentType: false,
        cache: false,
        timeout: 600000,
        beforeSend: function(xhr) {
          // xhr.setRequestHeader(
          //         $('meta[name=_csrf_header]').attr('content'),
          //         $('meta[name=_csrf]').attr('content')
          // )
          $('#wait-modal-title').text("Saving Image...");
          $('#wait-modal').modal('show');
        },
        success: function (data) {
          $('#wait-modal').modal('hide');
          $("#image-upload-result").text("Success");
          $("#image-upload-result").css('color', 'green');
          $("#uploaded-images-container").css('display', 'flex');
          console.log("SUCCESS : ", data);
          $("#file-upload-form").prop("disabled", false);
          const newImage = `
                    <div style="flex: 1;">
                        <img src="${data.src}" data-id="${data.id}"style="max-width: 100%; max-height: 300px;">
                    </div>
                `;
          $("#uploaded-images-container").append(newImage);

          const imageChooser = `
                    <div style="flex: 1;" class="image-modal-display" onclick="assign_image('${data.src}', '${data.id}')">
                        <img src="${data.src}" data-id="${data.id}" style="max-width: 100%; max-height: 300px;">
                    </div>
                `;

          $("#images-modal-body").css('display', 'flex');
          $('#images-modal-body').append(imageChooser);
          // $('.product-image-select').each(function () {
          //   for(let i = 0; i < imageUrls.length; i++){
          //     $(this).append($('<option>', {
          //       value: data,
          //       text : data
          //     }));
          //   }
          // });
          imageUrls.push(data);
          numImagesUploaded++;

        },
        error: function (e) {
          console.log(xhr);
          testing = xhr;
          $('#wait-modal').modal('hide');

          $('#failed-modal-message-header').text("Media Upload Failed");
          var responseMessagesString = '';
          let responseMessages = xhr.responseJSON['messages'];

          if (responseMessages !== undefined) {
            for (let i = 0; i < responseMessages.length; i++) {
              responseMessagesString += ((i + 1) + ". " + responseMessages[i]['message'] + "\n");
            }
            $('#failed-modal-message').text("Error Message: \n" + responseMessagesString);
          } else {
            $('#failed-modal-message').text("Error Message: \nNo available Error Message.");
          }

          $('#failed-modal').modal('show');

          var failText = "Failed to Upload: ";
          $("#image-upload-result").text(failText.concat(e.responseText));
          $("#image-upload-result").css('color', 'red');
          console.log("ERROR : ", e);
          $("#file-upload-form").prop("disabled", false);

        }
      });
    });

    function update_variant_images(){
      $('#wait-modal-title').text("Updating Variants...");
      $('#wait-modal').modal('show');
      let productId = $('#finish-variants-table-2').data("product-id");
      let variants = [];
      let numVariants = parseInt($('#finish-variants-table-2').data("count"));
      for(let j = 0; j < numVariants; j++){
        let variantId = parseInt($("#variant-post-image-"+(j+1)).data("variant-id"));
        const updateData = {
          'imageId': parseInt($("#variant-post-image-"+(j+1)).data("image-id"))
        };
        console.log(updateData);
        $.ajax({
          type: "PATCH",
          url: '/api/secured/products/'.concat(productId).concat('/variants/').concat(variantId),
          contentType: "application/json",
          data: JSON.stringify(updateData), // serializes the form's elements.
          beforeSend: function(xhr) {
            // xhr.setRequestHeader(
            //         $('meta[name=_csrf_header]').attr('content'),
            //         $('meta[name=_csrf]').attr('content')
            // )

          },
          success: function()
          {
            if(j === numVariants-1){
              $('#wait-modal').modal('hide');

              $('#success-modal-message').text("Successfully updated Variant Images!");
              $('#success-modal').modal('show');;
            }
            // $('#success-redirect').attr("href", "/management/product/update?id="+pgid)
          },
          error: function(xhr) {
            console.log(xhr);
            testing = xhr;
            $('#wait-modal').modal('hide');

            $('#failed-modal-message-header').text("Product Variant Update Failed");
            var responseMessagesString = '';
            let responseMessages = xhr.responseJSON['messages'];

            if (responseMessages !== undefined) {
              for (let i = 0; i < responseMessages.length; i++) {
                responseMessagesString += ((i + 1) + ". " + responseMessages[i]['message'] + "\n");
              }
              $('#failed-modal-message').text("Error Message: \n" + responseMessagesString);
            } else {
              $('#failed-modal-message').text("Error Message: \nNo available Error Message.");
            }

            $('#failed-modal').modal('show');
          }
        });
      }
    }


  </script>

  <!--  <script th:src="@{/javascript/management/product/product_create.js}"></script>-->
</div>
</html>